"use strict";var UBO_CONTAINER_MIN_HEIGHT="500",UBO_CONTAINER_MIN_WIDTH="800",UBO_RESOURCE_URL="https://d1mg2a4jjfsr4e.cloudfront.net/prod",UBO_UNDISCLOSED="undiscl.",UBO_MAJORITY="MAJORITY",UBO_PSC="Has PSC",UBO_POWEREDBY='<img src="'+UBO_RESOURCE_URL+'/img/poweredby.svg" width="157px" height="55px"/>',ERROR_UG001="containerId must be string:Error-UG001",ERROR_UG002="data must be string:Error-UG002",ERROR_UG003="controls must be boolean (true or false):Error-UG003",ERROR_UG004="containerId is not present:Error-UG004",ERROR_UG005="Container is too small, height > 500px and width > 800px:Error-UG005",ERROR_UG006="We have not been able to complete this request. Please contact your local Customer Services Team:Error-UG006",ERROR_UG007="We have not been able to complete this request. Please contact your local Customer Services Team:Error-UG007",ERROR_UG008="Missing containerId (string) and  data (JSON Object):Error-UG008",ERROR_UG009="There is no ownership OR Persons of Significant control ( PSC)  data present for the Target business entity:Error-UG009",ERROR_UG010="There is no ownership OR Persons of Significant control ( PSC)  data present for the Target business entity:Error-UG010",ERROR_UG011="The requested Target business entity is not present in our records. Please contact your local Customer Services Team :Error-UG011",ERROR_UG012="ContainerID or Data is not present:Error-UG012",ERROR_UG013="We do not have any information that matches your filter criteria, please amend your filter options and try again",TOAST_ADD_NODE="Please drag from an organisation node to an empty space to create a new node.<br>Please drag from an organisation node to another node to create a new relationship.",LARGEST_BEN_ERROR="There is no single largest beneficiary available for this D-U-N-S®.",MERGE_NODE_PRESENT="Graph contains merged node",ERROR_NO_SEARCH_RESULTS="Sorry, no node matched your search. Please try again.",ERROR_NO_SEARCH_INPUT="Please provide search input.",TOAST_EXPAND_FILTER="Filter the nodes based on beneficial ownership percentage",TOAST_UNCHK_UPDT_LAYOUT="The layout will remain static when you make changes to the graph using other advanced options",TOAST_CHK_UPDT_LAYOUT="The layout will update automatically to the most optimal view when you make changes to the graph using other advanced options",TOAST_MERGE_NODE="Drag and drop similar nodes types(Individuals, Entites) to merge.<br>Right click on a merged node to unmerge.",TOAST_CONFIG_NODE="The additional labels selected will be displayed in the graph.<br>The additional labels when selected will appear in the exported image.",TOAST_FORCELINK="Force Link Layout is applied",TOAST_RADIAL="Radial Layout is applied",TOAST_HIERARCHICAL="Hierarchical Layout is applied",TOAST_GRID="Grid Layout is applied",TOAST_CONCENTRIC="Concentric Layout is applied",TOAST_PATH_LRG_BEN="There is no single largest beneficiary available for this D-U-N-S®",TOAST_EXPORT_PNG=" is downloading",TOAST_MERGE_NODE_PRESENT="Graph contains merged node",MAX_BEN_PCT=0,LAYOUT_DURATION=300,HELP_LANG="en",LOCATE_OPTIONS={duration:300,padding:{top:80,bottom:80,left:30,right:30}},PULSE_OPTIONS={number:3,duration:2700,interval:900,startColor:"#ff756e",endColor:"rgb(255,255,255)",width:5,startRatio:1,endRatio:5};var parentHt=0,parentWd=0;function UBOGraph(containerId,parentId,data){var ogma,targetDuns=1,targetNode=1,uboLayout=0,CONTAIN_UNDISCLOSED=false,toggler={arrow:true,label:true,pulse:true,pulseId:-1},domKey,globalNodeRule=null,globalEdgeRule=null,sizeRule=null,nodeTextRule=null,edgeTextRule=null,benFilter=null,pscNodeFilter,pscEdgeFilter,corporateFilter,pscUnavailableReason=[],nodeSecTextRule=null,rels=[],paths={};this.containerId=containerId;this.parentId=parentId;var self=this;domKey=parentId+"-"+containerId;this.getPng=function(){if(ogma!=undefined){return ogma.export.png({download:false,clip:true,background:"white",texts:true,imageCrossOrigin:"anonymous"})}else{return false}};this.validateRequest=function(){if(containerId===undefined&&data===undefined){throw ERROR_UG008}if(containerId===undefined||data===undefined){throw ERROR_UG012}if(typeof containerId!=="string"){throw ERROR_UG001}if(typeof data!=="string"){throw ERROR_UG002}var element=document.getElementById(containerId);if(element=="undefined"){throw ERROR_UG004}if($("#"+parentId+" #"+containerId).height()<UBO_CONTAINER_MIN_HEIGHT||$("#"+parentId+" #"+containerId).width()<UBO_CONTAINER_MIN_WIDTH){throw ERROR_UG005}};this.initGraph=function(){$("#"+domKey+" #ubo-message").hide();var g=this.getGraphData(),graphicMode=0;data=null;if(g.nodes.length>100){graphicMode=1}try{if(ogma){ogma=null}ogma=new Ogma({renderer:["canvas","webgl"][graphicMode],imgCrossOrigin:"anonymous",plugins:["dagre"]});ogma.setContainer(domKey);ogma.setOptions({backgroundColor:"#fff",texts:{preventOverlap:false}});ogma.tools.brand.set(UBO_POWEREDBY,{position:"top-right",className:"ubo-brand"});ogma.setGraph(g).then(function(){return self.runLayout("forceLink")}).then(function(){ogma.removeEdges(0);self.getNOCDtls();$("#"+domKey+" #ubo-loading").fadeOut("fast");$("#"+domKey+" #ubo-viewController").show();parentHt=$("#"+domKey).find("canvas").height();parentWd=$("#"+domKey).find("canvas").width();self.applyEdgeStyleRules();self.applyNodeTextRule(true);self.applyEdgeTextRule(true);self.togglePulse();self.registerEvents();self.calculateCounts();self.getLargestBen()});this.applyNodeStyleRules()}catch(err){throw ERROR_UG007}return ogma};this.runLayout=function(name){var nodeCount=ogma.getNodes("visible").size>2?0:2e3;var sizeFlag=false;var undefinedCount=0;ogma.getNodes("all").forEach(function(node){if(node.getData().hasOwnProperty("BeneficialOwnershipPercentage")&&parseFloat(node.getData("BeneficialOwnershipPercentage"))>85){sizeFlag=true}if(!node.getData().hasOwnProperty("BeneficialOwnershipPercentage")){undefinedCount++}});if(undefinedCount>10){sizeFlag=false}nodeCount=sizeFlag?2e3:0;return ogma.layouts[name]({locate:LOCATE_OPTIONS,duration:LAYOUT_DURATION,useWebWorker:true,centralNode:targetNode,rankdir:"BT",nodeGap:15,renderSteps:true,repulsion:5,epsilon:.1,skipTextDrawing:true,scalingRatio:300+nodeCount,maxIterations:100,autoStop:true,barnesHutOptimize:true,gravity:.5,radiusDelta:20})};this.getNOCDtls=function(){ogma.getEdges("all").forEach(function(edge){if(edge.getData("RelationshipTypeDescription.@DNBCodeValue")==33700){ogma.getNodes("all").forEach(function(node){if($.trim(edge.getTarget().getId().toString())==$.trim(node.getId().toString())){if(edge.getData().hasOwnProperty("NatureOfControlClassDescription")){node.setData("NatureOfControlStartDate",edge.getData("NatureOfControlStartDate"));node.setData("NatureOfControlClassDescription",edge.getData("NatureOfControlClassDescription"))}}})}})};this.applyNodeStyleRules=function(){globalNodeRule=ogma.styles.addNodeRule({radius:ogma.rules.slices({field:"BeneficialOwnershipPercentage",values:{nbSlices:100,min:5,max:100},stops:{min:0,max:300}}),shape:"circle",color:function(n){var type=n.getData("SubjectTypeDescription.@DNBCodeValue"),duns=n.getData("DUNSNumber");if(n.getData("groupFlag")){return"#E7B24E"}else if(duns&&n.getData("ControlOwnershipTypeText.$")!=null&&n.getData("ControlOwnershipTypeText.$")!=undefined&&n.getData("OutofBusinessIndicator")==false&&duns!=targetDuns){if(n.getData("ControlOwnershipTypeText.@DNBCodeValue")==9059){return"#ff99ff"}else if(n.getData("ControlOwnershipTypeText.@DNBCodeValue")==32495){return"#e600e6"}else if(n.getData("ControlOwnershipTypeText.@DNBCodeValue")==9057){return"#ff66ff"}else if(n.getData("ControlOwnershipTypeText.@DNBCodeValue")==9058){return"#ffccff"}}else if(duns&&n.getData("OutofBusinessIndicator")==true){return"grey"}else{if(duns){if(duns===targetDuns){targetNode=n.getId();return"#ff756e"}else{return"#68BDF6"}}else{if(type==30912){return"#bab86c"}else{return"#6DCE9E"}}}},icon:{content:function(n){var type=n.getData("SubjectTypeDescription.@DNBCodeValue"),duns=n.getData("DUNSNumber");if(duns){return""}if(type){if(type==119){return""}else if(type==100){return""}else if(type==30912){return""}else{return""}}else{return""}},color:"#424242",font:"FontAwesome",scale:.5,threshold:0},outerStroke:{width:1,color:"grey"},innerStroke:{width:0},badges:{topRight:{color:"#ff756e",scale:function(n){var bo=n.getData("BeneficialOwnershipPercentage"),ctry=n.getData("PrimaryAddress.CountryISOAlpha2Code");if(ctry==undefined&&bo==undefined||ctry==undefined&&n.getData("valueUndefined")){return 0}else{return.5}},positionScale:1.2,threshold:1,stroke:{color:"grey",width:function(n){var bo=n.getData("BeneficialOwnershipPercentage"),ctry=n.getData("PrimaryAddress.CountryISOAlpha2Code");if(ctry==undefined&&bo==undefined||ctry==undefined&&n.getData("valueUndefined")){return 0}else{return 1}}},text:{color:"#fff",content:function(n){var bo=n.getData("BeneficialOwnershipPercentage");if(bo==undefined){return""}else{return bo+"%"}},style:"bold",scale:.29},image:function(n){var ctry=n.getData("PrimaryAddress.CountryISOAlpha2Code"),bo=n.getData("BeneficialOwnershipPercentage");if(ctry==undefined){ctry="tmp"}if(ctry=="HK"||ctry=="MO"||ctry=="TW"){ctry="grey"}var pscNode=false;ogma.getEdges("all").forEach(function(edge){if(edge.getData("RelationshipTypeDescription.@DNBCodeValue")==33700&&edge.getData("TargetMemberID")==n.getData("MemberID")){pscNode=true}});if(bo==undefined){if(n.getData("BeneficiaryIndicator")==true&&!pscNode){CONTAIN_UNDISCLOSED=true}return UBO_RESOURCE_URL+"/"+"img/flag/"+ctry.toLowerCase()+".png"}else{return null}}},topLeft:{color:"#ff756e",stroke:{color:"grey",width:function(n){if(n.getData("groupFlag"))return 1;else return 0}},scale:function(n){if(n.getData("groupFlag"))return.5;else return 0},positionScale:1.2,minVisibleSize:1,text:{color:"#fff",content:function(n){var name=n.getData("PrimaryName");if(name!=undefined){var nameArray=name.split(";");return nameArray.length}},style:"bold",scale:.29}}}})};this.applyNodeTextRule=function(checkBox){if(checkBox&&!nodeTextRule){nodeTextRule=ogma.styles.addNodeRule({text:{content:function(node){var name=node.getData("PrimaryName"),type=node.getData("SubjectTypeDescription.@DNBCodeValue");if(!name){if(type==30912){name="Super Secured"}else{name=""}}var color=node.getAttribute("color");if(color==="#E7B24E"){if(toggler.arrow){node.getAdjacentEdges().setAttributes({shape:"arrow"})}else{node.getAdjacentEdges().setAttributes({shape:"tapered"})}return name}else{return name}},secondary:{content:function(node){return node.getData("SecondaryName")}},position:"bottom",maxLineLength:30,scaling:false,scale:.2,minVisibleSize:12,color:"#576574",align:"left"}})}else if(!checkBox&&nodeTextRule){nodeTextRule.delete();nodeTextRule=null}};this.applyEdgeStyleRules=function(){globalEdgeRule=ogma.styles.addEdgeRule({shape:"arrow",color:function(e){if(e.getData("RelationshipTypeDescription.@DNBCodeValue")==33700){return"rgba(29, 172, 214, 1.0)"}}})};this.applyEdgeTextRule=function(checkBox){if(checkBox&&!edgeTextRule){edgeTextRule=ogma.styles.addEdgeRule({width:1,text:{content:function(e){if(toggler.arrow){e.setAttributes({shape:"arrow"})}else{e.setAttributes({shape:"tapered"})}var type=e.getData("RelationshipTypeDescription.@DNBCodeValue"),share=e.getData("ShareHoldingPercentage");if(type==1012)return""+UBO_MAJORITY;else if(type==33700)return""+UBO_PSC;else return share!==undefined?share+"%":""+UBO_UNDISCLOSED},color:"#3095b4",style:"bold",backgroundColor:"#fff",size:12,scale:1,minVisibleSize:3}})}else if(!checkBox&&edgeTextRule){edgeTextRule.delete();edgeTextRule=null}};this.registerEvents=function(){ogma.styles.setHoveredNodeAttributes({outline:true,"outerStroke.color":"rgba(255, 117, 110,0.7)","outerStroke.width":2});ogma.styles.setSelectedNodeAttributes({"outerStroke.color":"rgb(255, 117, 110)","outerStroke.width":3});ogma.tools.tooltip.onEdgeHover(function(e){if(e.getData("isRemovable")==true){return"<div class='ubo-tooltip-body'>Right click to delete"}return""},{className:"ubo-tooltip",delay:800});ogma.tools.tooltip.onNodeHover(function(n){var pscNodes=[],benNodes=[],benandPsc=false,pscOnly=false,benOnly=false;ogma.getEdges().forEach(function(e){if(e.getData("RelationshipTypeDescription.@DNBCodeValue")==137||e.getData("RelationshipTypeDescription.@DNBCodeValue")==1012){benNodes.push(e.getData("TargetMemberID"))}else if(e.getData("RelationshipTypeDescription.@DNBCodeValue")==33700){pscNodes.push(e.getData("TargetMemberID"))}});ogma.getNodes().forEach(function(n){if(n.getData("DUNSNumber")==targetDuns){benNodes.push(n.getData("MemberID"))}});if(benNodes.includes(n.getData("MemberID"))&&pscNodes.includes(n.getData("MemberID"))){benandPsc=true}else if(pscNodes.includes(n.getData("MemberID"))){pscOnly=true}else if(benNodes.includes(n.getData("MemberID"))){benOnly=true}if(n.isNode==false)return"";if(typeof n.getData()==="undefined"){return""}else if(n.getData("addedNode")){return"<div class='ubo-tooltip-body'>Right click to delete"}if(n.getData("groupFlag"))return"<div class='ubo-tooltip-body'>Right click to unmerge";var html,icon=n.getAttribute("icon.content"),finalNameAfterTrim;if(n.getData().hasOwnProperty("PrimaryName")&&n.getData("PrimaryName").length>65){finalNameAfterTrim=trimAndAppendFieldsOnHeader(n.getData("PrimaryName"));html='<div class="arrow"></div>'+'<div class="ubo-tooltip-header"><span class="icon">'+icon+"</span>"+(n.getData().hasOwnProperty("PrimaryName")?finalNameAfterTrim:"Not Available")+"</div>"}else if(n.getData("SubjectTypeDescription.@DNBCodeValue")==30912){html='<div class="arrow"></div>'+'<div class="ubo-tooltip-header"><span class="icon">'+icon+"</span> "+"SUPER SECURED"+"</div>"}else{html='<div class="arrow"></div>'+'<div class="ubo-tooltip-header"><span class="icon">'+icon+"</span> "+(n.getData().hasOwnProperty("PrimaryName")?n.getData("PrimaryName"):"Not Available")+"</div>"}if(n.getData("SubjectTypeDescription.@DNBCodeValue")!=30912){html+='<div class="ubo-tooltip-body">'+"<table>";n.getData().hasOwnProperty("DUNSNumber")?html+="<tr><th>D-U-N-S®</th> <td>"+formatDUNS(n.getData("DUNSNumber"))+"</td></tr>":"";if(n.getData().hasOwnProperty("PrimaryName")&&n.getData("PrimaryName").length>33&&n.getData("SubjectTypeDescription.@DNBCodeValue")!=30912){finalNameAfterTrim=trimAndAppendFieldsOnHover(n.getData("PrimaryName"));n.getData().hasOwnProperty("PrimaryName")?html+='<tr><th>Name</th> <td><span class="ubo-tooltip-name">'+finalNameAfterTrim.substring(0,33)+"</br>"+finalNameAfterTrim.substring(33,finalNameAfterTrim.length)+"</span></td></tr>":"Not Available"}else if(n.getData("SubjectTypeDescription.@DNBCodeValue")==30912){html+="<tr><th>Name</th> <td>"+"SUPER SECURED"+"</td></tr>"}else{n.getData().hasOwnProperty("PrimaryName")?html+="<tr><th>Name</th> <td>"+n.getData("PrimaryName")+"</td></tr>":"Not Available"}if(setNOCClassDescription(n.getData("NatureOfControlClassDescription"))!="")n.getData().hasOwnProperty("NatureOfControlClassDescription")&&(benandPsc||pscOnly)?html+="<tr><th>NOC Class(text)</th> <td>"+setNOCClassDescription(n.getData("NatureOfControlClassDescription"))+"</td></tr>":"";n.getData().hasOwnProperty("NatureOfControlStartDate")&&(benandPsc||pscOnly)?html+="<tr><th>NOC Date</th> <td>"+n.getData("NatureOfControlStartDate")+"</td></tr>":"";n.getData().hasOwnProperty("PrimaryAddress")?html=addressFormation(n.getData("PrimaryAddress"),html):"";n.getData().hasOwnProperty("ResidenceCountryName")&&pscOnly?html+="<tr><th>Country of residence</th> <td>"+n.getData("ResidenceCountryName")+"</td></tr>":"";n.getData().hasOwnProperty("Nationality")?html+="<tr><th>Nationality</th> <td>"+n.getData("Nationality")+"</td></tr>":"";n.getData().hasOwnProperty("BirthDate")?html+="<tr><th>Date of Birth</th> <td>"+n.getData("BirthDate")+"</td></tr>":"";n.getData().hasOwnProperty("LegalAuthorityName")&&pscOnly?html+="<tr><th>Legal Authority</th> <td>"+n.getData("LegalAuthorityName")+"</td></tr>":"";n.getData().hasOwnProperty("LegalForm")&&pscOnly?html+="<tr><th>Legal Form Text</th> <td>"+n.getData("LegalForm")+"</td></tr>":"";n.getData().hasOwnProperty("DirectOwnershipPercentage")&&(benandPsc||benOnly)?html+="<tr><th>Direct Ownership</th> <td>"+n.getData("DirectOwnershipPercentage")+"%"+"</td></tr>":"";n.getData().hasOwnProperty("IndirectOwnershipPercentage")?html+="<tr><th>Indirect Ownership</th> <td>"+n.getData("IndirectOwnershipPercentage")+"%"+"</td></tr>":"";n.getData().hasOwnProperty("BeneficialOwnershipPercentage")?html+="<tr><th>Beneficiary</th> <td>"+n.getData("BeneficialOwnershipPercentage")+"%"+"</td></tr>":html+=n.getData().hasOwnProperty("BeneficiaryIndicator")&&(benandPsc||benOnly)?"<tr><th>Beneficiary </th> <td>"+(n.getData("BeneficiaryIndicator")==true?"Yes":"No")+"</td></tr>":"";n.getData().hasOwnProperty("OutofBusinessIndicator")?html+="<tr><th>Status</th> <td>"+(n.getData("OutofBusinessIndicator")==true?"Out of Business":"Active")+"</td></tr>":"";n.getData().hasOwnProperty("ControlOwnershipTypeText")?html+="<tr><th>Control Type</th><td>"+n.getData("ControlOwnershipTypeText.$")+(n.getData().hasOwnProperty("ControlOwnershipTypeConfidenceLevel")?" (Confidence:"+n.getData("ControlOwnershipTypeConfidenceLevel.$")+")":"")+"</td></tr>":"";n.getData().hasOwnProperty("OwnershipUnavailableReason")&&(benandPsc||benOnly)?html=setReason(n.getData("OwnershipUnavailableReason"),html):"";n.getData("DUNSNumber")==targetDuns?html=setPSCReason(pscUnavailableReason,html):"";html+="</table>"+'</div><div class="ubo-tooltip-footer">';benandPsc||benOnly?html+="<span>Number of shareholders: "+n.getDegree("out")+"</span>":""}if(n.getData("SubjectTypeDescription.@DNBCodeValue")==30912){html+='<span class="ubo-tooltip-depth" style="margin:5px 10px 5px 0;">'+(n.getData().hasOwnProperty("DegreeOfSeparation")?"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Depth:</th><td>"+n.getData("DegreeOfSeparation")+"</span>":"")+"</div>"}else{html+='<span class="ubo-tooltip-depth">'+(n.getData().hasOwnProperty("DegreeOfSeparation")?"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Depth:</th><td>"+n.getData("DegreeOfSeparation")+"</span>":"")+"</div>"}return html},{className:"ubo-tooltip",delay:800});ogma.styles.setHoveredEdgeAttributes({outline:false,color:function(e){if(e.getData("RelationshipTypeDescription.@DNBCodeValue")==33700){return"rgba(29, 150, 214, 1.0)"}else{return"rgba(255, 117, 110, 1.0)"}},text:{backgroundColor:"#fff"}});ogma.styles.setSelectedEdgeAttributes({color:function(e){if(e.getData("RelationshipTypeDescription.@DNBCodeValue")==33700){return"rgba(29, 172, 214, 1.0)"}else{return"rgba(255, 117, 110, 1.0)"}}});ogma.events.onNodesSelected(function(evt){var selNode=evt.nodes.getId();self.pathFinder(targetNode,selNode)});ogma.events.onClick(function(evt){if(evt.target===null){ogma.clearSelection()}});ogma.events.onNodeDragEnd(function(evt){if($("#"+domKey+" #ubo-leftViewController"+" #merge").css("background-color")=="rgb(33, 149, 123)"){var selectedNodes=[];evt.nodes.forEach(function(node,index){var x,y;var box=node.getBoundingBox();ogma.getNodes().forEach(function(node){x=node.getPosition()["x"];y=node.getPosition()["y"];if(x>=box["minX"]&&x<=box["maxX"]&&(y>=box["minY"]&&y<=box["maxY"])){selectedNodes.push(node)}})});if(selectedNodes.length==2)self.groupSelection(selectedNodes,evt.end)}return});$("#"+domKey+" #ubo-leftViewController"+" #addNode").on("click",function(){$(".ubo_CountHighlight").removeClass("bold")});ogma.events.onDragStart(function(evt){$(".ubo_CountHighlight").removeClass("bold");if($("#"+domKey+" #ubo-leftViewController"+" #addNode").css("background-color")=="rgb(33, 149, 123)"){if(evt.target==null||!evt.target.getData("DUNSNumber")){return false}ogma.tools.connectNodes.enable({condition:function(evt){if(evt.getData("SubjectTypeDescription.@DNBCodeValue")!=30912){return true}},strokeColor:"red",onComplete:function(evt){if(evt.target.getData("SubjectTypeDescription.@DNBCodeValue")!=30912){if(evt.target.isNode&&typeof evt.target.getData()=="undefined"){var n=evt.target;n.setAttributes({color:"orange"});n.setData("ndisplay","on");var dialog,form,isSubmitted=false;dialog=$("#"+domKey+"-dialog-form").dialog({height:410,width:300,resizable:false,modal:true,buttons:{OkButton:{text:"OK",id:"okNode",click:function(){if($("#"+domKey+"-nodeTypeSelect option:selected").text()!="Select"){$("#"+domKey+"-nodeTypeSelect").css("border-color","");if($("#"+domKey+"-primaryText").val()){$("#"+domKey+"-primaryText").css("border-color","")}else{$("#"+domKey+"-primaryText").css("border-color","red");$("#"+domKey+"-primaryText").attr("placeholder","Name is mandatory");return false}}else{$("#"+domKey+"-nodeTypeSelect").css("border-color","red");return false}n.setData("addedNode",true);var nodeType=$("#"+domKey+"-nodeTypeSelect option:selected").text();if(nodeType=="Organisation"){n.setData("DUNSNumber","#temp")}else if(nodeType=="Individual"){n.setData("SubjectTypeDescription.@DNBCodeValue",119);n.setData("BeneficiaryIndicator",true)}else if(nodeType=="Entity"){n.setData("SubjectTypeDescription.@DNBCodeValue",118);n.setData("BeneficiaryIndicator",true)}else if(nodeType=="Others"){n.setData("SubjectTypeDescription.@DNBCodeValue",100);n.setData("BeneficiaryIndicator",true)}var nocClass=[];nocClass.push($("#"+domKey+"-nocClassSelectWrapper option:selected").text());if($("#"+domKey+"-nocClassSelectWrapper option:selected").val()!=0){var namePSC=$("#"+domKey+"-secondaryText").val()+"\n"+nocClass;n.setData("PrimaryName",$("#"+domKey+"-primaryText").val());n.setData("SecondaryName",namePSC)}else{n.setData("PrimaryName",$("#"+domKey+"-primaryText").val());n.setData("SecondaryName",$("#"+domKey+"-secondaryText").val())}var e=evt.edge;e.setData("isRemovable",true);var percentageValue=$("#"+domKey+"-percentageValNode").val();var relationType=$("#"+domKey+"-relationTypeSelect option:selected").val();if(relationType=="Ownership"){e.setAttributes({color:"orange"});if(percentageValue){e.setData("ShareHoldingPercentage",percentageValue)}else{e.setData("RelationshipTypeDescription.@DNBCodeValue",1072)}}else{e.setAttributes({color:"rgba(29, 172, 214, 1.0)"});e.setData("RelationshipTypeDescription.@DNBCodeValue",33700);e.setData("TargetMemberID",n.getId());n.setData("MemberID",n.getId())}if(toggler.arrow){e.setAttributes({shape:"arrow"})}else{e.setAttributes({shape:"tapered"})}self.clearDialogBox();isSubmitted=true;self.refreshLayout();setTimeout(function(){self.calculateCounts()},400);dialog.dialog("close")}}},close:function(){if(!isSubmitted){ogma.removeNode(n)}self.clearDialogBox();dialog.dialog("close")}});if($("#"+domKey).find("canvas").width()>1200){$(".ui-widget-overlay").appendTo("#"+domKey);$("#"+domKey+"-dialog-form").parent().appendTo("#"+domKey)}$("#"+domKey+"-dialog-form").parent().position({of:window});$("#"+domKey+"-dialog-form").parents(".ui-dialog").find(".ui-dialog-titlebar-close").attr("title","Close")}else{var dialog,form,isEdgeCreated=false;var e=evt.edge;dialog=$("#"+domKey+"-dialog-form-edge").dialog({height:200,width:300,resizable:false,modal:true,buttons:{OkButton:{text:"OK",id:"okEdge",click:function(){e.setData("isRemovable",true);e.setAttributes({color:"orange"});var percentageValue=$("#"+domKey+"-percentageVal").val();if(percentageValue){e.setData("ShareHoldingPercentage",$("#"+domKey+"-percentageVal").val())}else{e.setData("RelationshipTypeDescription.@DNBCodeValue",1072)}if(toggler.arrow){e.setAttributes({shape:"arrow"})}else{e.setAttributes({shape:"tapered"})}isEdgeCreated=true;$("#"+domKey+"-percentageVal").val("");self.refreshLayout();dialog.dialog("close")}}},close:function(){if(!isEdgeCreated){ogma.removeEdge(e)}$("#"+domKey+"-percentageVal").val("");dialog.dialog("close")}});self.refreshLayout();self.calculateCounts();if($("#"+domKey).find("canvas").width()>1200){$(".ui-widget-overlay").appendTo("#"+domKey);$("#"+domKey+"-dialog-form-edge").parent().appendTo("#"+domKey)}$("#"+domKey+"-dialog-form-edge").parent().position({of:window});$("#"+domKey+"-dialog-form-edge").parents(".ui-dialog").find(".ui-dialog-titlebar-close").attr("title","Close")}}},onNodeCreated:function(n){},onEdgeCreated:function(e){}})}});ogma.tools.tooltip.onNodeRightClick(function(node){var transformationId=node.getData("transformationId");if(typeof transformationId!="undefined"){node.getAdjacentEdges("in").forEach(function(edge){if(edge.getData("isRemovable")){ogma.removeEdge(edge)}});transformationId.destroy(300).then(function(){self.applyNodeSecondaryTextRule();self.refreshLayout();setTimeout(function(){self.calculateCounts()},400)})}if(node.getId()!=undefined&&node.getData("addedNode")===true){ogma.removeNode(node);self.refreshLayout();setTimeout(function(){self.calculateCounts()},400)}return""});ogma.tools.tooltip.onEdgeRightClick(function(edge){if(edge.getData("isRemovable")){ogma.removeEdge(edge)}return""});$("#"+domKey+" #showControls").click(self.showControls);$("#"+domKey+" #zoomReset").click(self.zoomReset);$("#"+domKey+" #locateRandomNode").click(self.locateRandomNode);$("#"+domKey+" #zoomIn").click(self.zoomIn);$("#"+domKey+" #zoomOut").click(self.zoomOut);$("#"+domKey+" #rotateLeft").click(self.rotateLeft);$("#"+domKey+" #rotateRight").click(self.rotateRight);$("#"+domKey+" #changeLayout").click(self.changeLayout);$("#"+domKey+" #changeEdgeStyle").click(self.changeEdgeStyle);$("#"+domKey+" #toggleNodeText").click(self.toggleNodeText);$("#"+domKey+" #selectNodes").click(self.selectNodes);$("#"+domKey+" #toggleLegend").click(self.toggleLegend);$("#"+domKey+" #togglePulse").click(self.togglePulse);$("#"+domKey+" #exportImage").click(self.exportImage);$("#"+domKey+" #fullScreen").click(self.fullScreen);$("#"+domKey+" #ubo-help").click(self.help);$("#"+domKey+" #path-large-ben").click(self.getLargestBen);$("#"+domKey+" #ubo-leftViewController"+" #ubo-slider").on("slidechange",self.updateBenFilter);$("#"+domKey+" #ubo-leftViewController"+" #box-run-layout").on("input change",function(){$(".ubo_CountHighlight").removeClass("bold");if($("#"+domKey+" #ubo-leftViewController"+" #info-msg").is(":checked")){if($("#"+domKey+" #ubo-leftViewController"+" #box-run-layout").is(":checked")){showToastMessages(TOAST_CHK_UPDT_LAYOUT)}else{showToastMessages(TOAST_UNCHK_UPDT_LAYOUT)}}self.refreshLayout()});$("#"+domKey+" #closeMenu").click(self.toggleLeftMenu);$("#"+domKey+" #toggleLeftMenu").click(self.toggleLeftMenu);$("#"+domKey+" #ubo-leftViewController"+" #btnReset").click(self.clear);$("#"+domKey+" #ubo-leftViewController"+" #box-exclude-ud").on("change",self.updateBenFilter);this.applyNodeSecondaryTextRule=function(){var selected=[];var unselected=[];var div="#"+domKey;$("div input:checked").each(function(){if($(this).attr("id")!=undefined){selected.push($(this).attr("id"))}});if(null!=nodeSecTextRule){nodeSecTextRule.delete();nodeSecTextRule=null}nodeSecTextRule=ogma.styles.addNodeRule({text:{secondary:{content:function(node){var returnval;if(null!=node.getData("MemberID")&&undefined!=node.getData("MemberID")){var type=node.getData("SubjectTypeDescription.@DNBCodeValue"),duns=node.getData("DUNSNumber");if(!duns&&type&&type==119){if(selected.includes(domKey+"-uboIndAdd")){if(null!=node.getData("PrimaryAddress")&&undefined!=node.getData("PrimaryAddress")){var address=getaddress(node.getData("PrimaryAddress"));if(null!=returnval&&secText!=returnval){returnval=secText+"\n"+"Address: "+address}else returnval="Address: "+address}}if(selected.includes(domKey+"-uboIndDOB")){if(node.getData().hasOwnProperty("BirthDate")){if(null!=returnval&&undefined!=returnval){returnval=returnval+"\n"+"Date Of Birth: "+node.getData("BirthDate")}else returnval="Date Of Birth: "+node.getData("BirthDate")}}if(selected.includes(domKey+"-uboindNationality")){if(node.getData().hasOwnProperty("Nationality")){if(null!=returnval&&undefined!=returnval){returnval=returnval+"\n"+"Nationality(PSC): "+node.getData("Nationality")}else returnval="Nationality(PSC): "+node.getData("Nationality")}}if(selected.includes(domKey+"-uboindNOC")){if(node.getData().hasOwnProperty("NatureOfControlClassDescription")){if(null!=returnval&&undefined!=returnval){returnval=returnval+"\n"+"Nature of Control (NOC): "+setNOCClassDescription(node.getData("NatureOfControlClassDescription"))}else returnval="Nature of Control (NOC): "+setNOCClassDescription(node.getData("NatureOfControlClassDescription"))}}if(selected.includes(domKey+"-uboindDoNOC")){if(node.getData().hasOwnProperty("NatureOfControlStartDate")){if(null!=returnval&&undefined!=returnval){returnval=returnval+"\n"+"Date of NOC (PSC): "+node.getData("NatureOfControlStartDate")}else returnval="Date of NOC (PSC): "+node.getData("NatureOfControlStartDate")}}if(selected.includes(domKey+"-uboindCtryRes")){if(node.getData().hasOwnProperty("ResidenceCountryName")){if(null!=returnval&&undefined!=returnval){returnval=returnval+"\n"+"Country of Residence (PSC): "+node.getData("ResidenceCountryName")}else returnval="Country of Residence (PSC): "+node.getData("ResidenceCountryName")}}}else if(duns!=null&&duns!=undefined){if(selected.includes(domKey+"-uboDuns")){if(null!=returnval&&undefined!=returnval){returnval=returnval+"\n"+"DUNS: "+formatDUNS(node.getData("DUNSNumber"))}else returnval="DUNS: "+formatDUNS(node.getData("DUNSNumber"))}if(selected.includes(domKey+"-uboOrgcountry")){if(node.getData().hasOwnProperty("PrimaryAddress")&&null!=node.getData("PrimaryAddress.CountryOfficialName")&&node.getData("PrimaryAddress.CountryOfficialName")){if(null!=returnval&&undefined!=returnval){if(node.getData("PrimaryAddress.CountryISOAlpha2Code")&&node.getData("PrimaryAddress.CountryOfficialName")&&(node.getData("PrimaryAddress.CountryISOAlpha2Code")=="HK"||node.getData("PrimaryAddress.CountryISOAlpha2Code")=="MO"))returnval=returnval+"\n"+"Country: "+node.getData("PrimaryAddress.CountryOfficialName")+" SAR";else if(node.getData("PrimaryAddress.CountryISOAlpha2Code")&&node.getData("PrimaryAddress.CountryOfficialName")&&node.getData("PrimaryAddress.CountryISOAlpha2Code")=="TW")returnval=returnval+"\n"+"Country: "+node.getData("PrimaryAddress.CountryOfficialName")+" Region";else returnval=returnval+"\n"+"Country: "+node.getData("PrimaryAddress.CountryOfficialName")}else{if(node.getData("PrimaryAddress.CountryISOAlpha2Code")&&node.getData("PrimaryAddress.CountryOfficialName")&&(node.getData("PrimaryAddress.CountryISOAlpha2Code")=="HK"||node.getData("PrimaryAddress.CountryISOAlpha2Code")=="MO"))returnval="Country: "+node.getData("PrimaryAddress.CountryOfficialName")+" SAR";else if(node.getData("PrimaryAddress.CountryISOAlpha2Code")&&node.getData("PrimaryAddress.CountryOfficialName")&&node.getData("PrimaryAddress.CountryISOAlpha2Code")=="TW")returnval="Country: "+node.getData("PrimaryAddress.CountryOfficialName")+" Region";else returnval="Country: "+node.getData("PrimaryAddress.CountryOfficialName")}}}if(selected.includes(domKey+"-uboControlType")){if(null!=node.getData("ControlOwnershipTypeText.$")&&undefined!=node.getData("ControlOwnershipTypeText.$")){if(null!=returnval&&undefined!=returnval){returnval=returnval+"\n"+"Control Type: "+node.getData("ControlOwnershipTypeText.$")}else{returnval="Control Type: "+node.getData("ControlOwnershipTypeText.$")}}}if(selected.includes(domKey+"-uboLegalForm")){if(null!=node.getData("LegalFormText.$")&&undefined!=node.getData("LegalFormText.$")){if(null!=returnval&&undefined!=returnval){returnval=returnval+"\n"+"Legal Form: "+node.getData("LegalFormText.$")}else returnval="Legal Form: "+node.getData("LegalFormText.$")}}if(selected.includes(domKey+"-uboNationality")){if(null!=node.getData("NationalityText.$")&&undefined!=node.getData("NationalityText.$")){if(null!=returnval&&undefined!=returnval){returnval=returnval+"\n"+"Nationality Form: "+node.getData("NationalityText.$")}else returnval="Legal Form: "+node.getData("LegalFormText.$")}}if(selected.includes(domKey+"-uboOrgAddress")){if(null!=node.getData("PrimaryAddress")&&undefined!=node.getData("PrimaryAddress")){var address=getaddress(node.getData("PrimaryAddress"));if(returnval!==null&&returnval!=undefined){returnval=returnval+"\n"+"Address: "+address}else returnval="Address: "+address}}if(selected.includes(domKey+"-uboorgNOC")){if(node.getData().hasOwnProperty("NatureOfControlClassDescription")){if(null!=returnval&&undefined!=returnval){returnval=returnval+"\n"+"Nature of Control (NOC): "+setNOCClassDescription(node.getData("NatureOfControlClassDescription"))}else returnval="Nature of Control (NOC): "+setNOCClassDescription(node.getData("NatureOfControlClassDescription"))}}if(selected.includes(domKey+"-uboorgDoNOC")){if(node.getData().hasOwnProperty("NatureOfControlStartDate")){if(null!=returnval&&undefined!=returnval){returnval=returnval+"\n"+"Date of NOC (PSC): "+node.getData("NatureOfControlStartDate")}else returnval="Date of NOC (PSC): "+node.getData("NatureOfControlStartDate")}}}else if(null!=node.getData("MemberID")&&undefined!=node.getData("MemberID")){if(selected.includes(domKey+"-uboEntAdd")){if(null!=node.getData("PrimaryAddress")&&undefined!=node.getData("PrimaryAddress")){var address=getaddress(node.getData("PrimaryAddress"));if(null!=returnval&&undefined!=returnval){returnval=returnval+"\n"+"Address: "+address}else returnval="Address: "+address}}if(selected.includes(domKey+"-uboEntCountry")){if(null!=node.getData("PrimaryAddress")&&undefined!=node.getData("PrimaryAddress")&&null!=node.getData("PrimaryAddress.CountryOfficialName")&&undefined!=node.getData("PrimaryAddress.CountryOfficialName")){if(null!=returnval&&undefined!=returnval){if(node.getData("PrimaryAddress.CountryISOAlpha2Code")&&node.getData("PrimaryAddress.CountryOfficialName")&&(node.getData("PrimaryAddress.CountryISOAlpha2Code")=="HK"||node.getData("PrimaryAddress.CountryISOAlpha2Code")=="MO"))returnval=returnval+"\n"+"Country: "+node.getData("PrimaryAddress.CountryOfficialName")+" SAR";else if(node.getData("PrimaryAddress.CountryISOAlpha2Code")&&node.getData("PrimaryAddress.CountryOfficialName")&&node.getData("PrimaryAddress.CountryISOAlpha2Code")=="TW")returnval=returnval+"\n"+"Country: "+node.getData("PrimaryAddress.CountryOfficialName")+" Region";else returnval=returnval+"\n"+"Country: "+node.getData("PrimaryAddress.CountryOfficialName")}else{if(node.getData("PrimaryAddress.CountryISOAlpha2Code")&&node.getData("PrimaryAddress.CountryOfficialName")&&(node.getData("PrimaryAddress.CountryISOAlpha2Code")=="HK"||node.getData("PrimaryAddress.CountryISOAlpha2Code")=="MO"))returnval="Country: "+node.getData("PrimaryAddress.CountryOfficialName")+" SAR";else if(node.getData("PrimaryAddress.CountryISOAlpha2Code")&&node.getData("PrimaryAddress.CountryOfficialName")&&node.getData("PrimaryAddress.CountryISOAlpha2Code")=="TW")returnval="Country: "+node.getData("PrimaryAddress.CountryOfficialName")+" Region";else returnval="Country: "+node.getData("PrimaryAddress.CountryOfficialName")}}}if(selected.includes(domKey+"-uboentNOC")){if(node.getData().hasOwnProperty("NatureOfControlClassDescription")){if(null!=returnval&&undefined!=returnval){returnval=returnval+"\n"+"Nature of Control (NOC): "+setNOCClassDescription(node.getData("NatureOfControlClassDescription"))}else returnval="Nature of Control (NOC): "+setNOCClassDescription(node.getData("NatureOfControlClassDescription"))}}if(selected.includes(domKey+"-uboentDoNOC")){if(node.getData().hasOwnProperty("NatureOfControlStartDate")){if(null!=returnval&&undefined!=returnval){returnval=returnval+"\n"+"Date of NOC (PSC): "+node.getData("NatureOfControlStartDate")}else returnval="Date of NOC (PSC): "+node.getData("NatureOfControlStartDate")}}if(selected.includes(domKey+"-uboentLegAuth")){if(node.getData().hasOwnProperty("LegalAuthorityName")){if(null!=returnval&&undefined!=returnval){returnval=returnval+"\n"+"Legal Authority (PSC): "+node.getData("LegalAuthorityName")}else returnval="Legal Authority (PSC): "+node.getData("LegalAuthorityName")}}if(selected.includes(domKey+"-uboentLegForm")){if(node.getData().hasOwnProperty("LegalForm")){if(null!=returnval&&undefined!=returnval){returnval=returnval+"\n"+"Legal Form (PSC): "+node.getData("LegalForm")}else returnval="Legal Form (PSC): "+node.getData("LegalForm")}}}return returnval}},scale:.2,minVisibleSize:12,color:"#576574"}}})};this.clearAllNodeLabels=function(){if(null!=nodeSecTextRule){nodeSecTextRule.delete();nodeSecTextRule=null}}};this.clearDialogBox=function(){$("#"+domKey+"-primaryText").attr("placeholder","Name of new node");$("#"+domKey+"-secondaryText").attr("placeholder","Additional information");$("#"+domKey+'-nodeTypeSelect option[value="0"]').attr("selected",true);$("#"+domKey+"-primaryText").val("");$("#"+domKey+"-secondaryText").val("");$("#"+domKey+"-percentageValNode").val("");$("#"+domKey+"-nodeTypeSelect").css("border-color","");$("#"+domKey+"-primaryText").css("border-color","");$("#"+domKey+'-relationTypeSelect option[value="Ownership"]').attr("selected",true);$("#"+domKey+'-nocClassSelect option[value="0"]').attr("selected",true);$("#"+domKey+"-relationTypeSelect").trigger("change")};this.getGraphData=function(){var g={nodes:[],edges:[]},json,members,edges,pscUnavailable;try{json=JSON.parse(data)}catch(e){throw ERROR_UG006}var org=json.OrderProductResponse.OrderProductResponseDetail.Product.Organization;var ownership=org.Linkage.BeneficialOwnership;var orgDetails=org.OrganizationDetail;if(orgDetails.hasOwnProperty("PSCUnavailableReason")){pscUnavailable=orgDetails.PSCUnavailableReason;for(var i=0;i<pscUnavailable.length;i++){pscUnavailableReason.push(pscUnavailable[i])}}if(org.SubjectHeader.hasOwnProperty("DUNSNumber")){targetDuns=org.SubjectHeader.DUNSNumber}else{throw ERROR_UG011}if(ownership.hasOwnProperty("BeneficialOwners")){members=ownership.BeneficialOwners;if(members.length===0){throw ERROR_UG009}if(ownership.hasOwnProperty("Relationships")){edges=ownership.Relationships}else{throw ERROR_UG010}if(edges.length===0){throw ERROR_UG010}for(var i=0;i<members.length;i++){var memberDuns=members[i].hasOwnProperty("DUNSNumber")?members[i].DUNSNumber:"";if(memberDuns===targetDuns){targetNode=members[i].MemberID}if(members[i].hasOwnProperty("BeneficialOwnershipPercentage")){if(MAX_BEN_PCT<parseFloat(members[i].BeneficialOwnershipPercentage)){MAX_BEN_PCT=parseFloat(members[i].BeneficialOwnershipPercentage)}}g.nodes.push({id:members[i].MemberID,data:members[i]})}for(i=0;i<edges.length;i++){g.edges.push({id:edges[i].RelationshipID,source:edges[i].SourceMemberID,target:edges[i].TargetMemberID,data:edges[i]});rels.push(new Array(edges[i].RelationshipID,edges[i].SourceMemberID,edges[i].TargetMemberID))}return g}else{g=getDataForStandALoneDuns(org)}return g};function getDataForStandALoneDuns(org){var g={nodes:[],edges:[]};targetNode=org.SubjectHeader.DUNSNumber;g.nodes.push({id:org.SubjectHeader.DUNSNumber,data:{PrimaryName:org.OrganizationName.OrganizationPrimaryName[0].OrganizationName.$,DUNSNumber:org.SubjectHeader.DUNSNumber,PrimaryAddress:org.Location.PrimaryAddress[0],OutofBusinessIndicator:org.OrganizationDetail.OutofBusinessIndicator,ControlOwnershipTypeText:org.OrganizationDetail.ControlOwnershipTypeText,DegreeOfSeparation:"0",OwnershipUnavailableReason:org.OrganizationDetail.OwnershipUnavailableReason}});g.edges.push({id:0,source:org.SubjectHeader.DUNSNumber,target:org.SubjectHeader.DUNSNumber,data:"null"});$("#"+domKey+" #ubo-viewController"+" #toggleLeftMenu").prop({disabled:true});shownNoOwnershipMessages(ERROR_UG009);return g}this.updateBenFilter=function(){rels=[];$(".ubo_CountHighlight").removeClass("bold");ogma.getEdges("all").forEach(function(edges){rels.push(new Array(edges.getId(),edges.getSource().getId(),edges.getTarget().getId()))});self.prepareFilters();$("#"+domKey+" #ubo-message").hide();self.removeNewNodes();self.removeNewEdges();$("#"+domKey+" #ubo-leftViewController"+" #merge").css("background","white");$("#"+domKey+" #ubo-leftViewController"+" #merge").css("color","black");var amount=$("#"+domKey+" #ubo-leftViewController"+" #ubo-slider").slider("value");ogma.getNodes("all").forEach(function(node){if(node.getData("addedNode")==undefined){node.setData("ndisplay","off")}});if(amount>0){ogma.getNodes("all").forEach(function(node){if(node.getData("NodeWithHasPsc")==true){var transformationId=node.getData("transformationId");transformationId.destroy(300).then(function(){self.applyNodeSecondaryTextRule();self.refreshLayout();setTimeout(function(){self.calculateCounts()},400)})}})}if(benFilter){benFilter.destroy().then(function(){benFilter=ogma.transformations.addNodeFilter(function(node){ogma.getNodes("visible").forEach(function(node){if(node.getData("BeneficialOwnershipPercentage")!=undefined){var benPer=parseFloat(node.getData("BeneficialOwnershipPercentage"))}var pscNode=false;var duns=node.getData("DUNSNumber");ogma.getEdges("visible").forEach(function(edge){if(edge.getData("RelationshipTypeDescription.@DNBCodeValue")==33700&&edge.getData("TargetMemberID")==node.getData("MemberID")){pscNode=true;if(duns&&duns!=targetDuns){node.setData("pscNodeIndicator",true)}}});if(benPer>=amount||$("#"+domKey+" #ubo-leftViewController"+" #box-exclude-ud").is(":checked")&&node.getData("BeneficialOwnershipPercentage")==undefined&&node.getData("BeneficiaryIndicator")==true||pscNode){var list=paths[node.getId()];for(var key in list){if(ogma.getEdge(key)!=undefined){ogma.getEdge(key).getSource().setData("ndisplay","on");ogma.getEdge(key).getTarget().setData("ndisplay","on")}}}});ogma.getNodes("visible").forEach(function(node){if(node.getData("valueUndefined")){node.setData("BeneficialOwnershipPercentage",undefined)}});var count=0;ogma.getNodes("visible").forEach(function(node){if(node.getData("ndisplay")==="on"&&node.getData("DUNSNumber")!=targetDuns){count++}});if(count==0){$("#"+domKey+" #ubo-message").show();$("#"+domKey+" #ubo-message").html('<div class="ubo-filterError ubo-errorFading">'+ERROR_UG013+"</div>");return node.getData("DUNSNumber")===targetDuns||node.getData("ndisplay")==="on"}else{return node.getData("DUNSNumber")===targetDuns||node.getData("ndisplay")==="on"}})});corporateFilter.destroy().then(function(){corporateFilter=ogma.transformations.addEdgeFilter(function(edge){edge.setData("ndisplay","on");var benPer,childNodeCnt=0;ogma.getNodes("all").forEach(function(node){var allBenNodes=[],largestBenPer1=0,largestBenPer2=0,largestBenPer=0;if(node.getData("pscCorpNodeIndicator")==true){ogma.getEdges("all").forEach(function(edge){if(node.getId()==edge.getData("SourceMemberID")){ogma.getNodes("all").forEach(function(node){if(edge.getTarget().getId()==node.getId()){allBenNodes.push(node)}})}});allBenNodes.forEach(function(e){if(e.getData("BeneficialOwnershipPercentage")!=undefined){if(largestBenPer1<parseFloat(e.getData("BeneficialOwnershipPercentage")))largestBenPer1=parseFloat(e.getData("BeneficialOwnershipPercentage"))}else{var nid=e.getId();largestBenPer2=getChildPercentage(nid,largestBenPer2)}if(largestBenPer1>largestBenPer2){largestBenPer=largestBenPer1}else{largestBenPer=largestBenPer2}});var list=paths[node.getId()];if(node.getData("BeneficialOwnershipPercentage")!=undefined){benPer=parseFloat(node.getData("BeneficialOwnershipPercentage"))}else{if(largestBenPer>0){benPer=largestBenPer}else{allBenNodes.forEach(function(e){if(e.getData("ndisplay")=="off")benPer=-1})}}if(benPer<amount||benPer==-1){for(var key in list){if(ogma.getEdge(key)!=undefined){if(ogma.getEdge(key).getData("ShareHoldingPercentage")!=undefined){ogma.getEdge(key).setData("ndisplay","off")}}}}}});return edge.getData("ndisplay")!="off"})});setTimeout(function(){benFilter.whenApplied().then(function(){self.refreshLayout();setTimeout(function(){self.calculateCounts()},200)})},300)}else{var edgesToRemove=[];benFilter=ogma.transformations.addNodeFilter(function(node){ogma.getNodes("visible").forEach(function(node){if(node.getData("BeneficialOwnershipPercentage")!=undefined){var benPer=parseFloat(node.getData("BeneficialOwnershipPercentage"))}var pscNode=false;var duns=node.getData("DUNSNumber");ogma.getEdges("visible").forEach(function(edge){if(edge.getData("RelationshipTypeDescription.@DNBCodeValue")==33700&&edge.getData("TargetMemberID")==node.getData("MemberID")){pscNode=true;if(duns&&duns!=targetDuns){node.setData("pscCorpNodeIndicator",true)}}});if(benPer>=amount||$("#"+domKey+" #ubo-leftViewController"+" #box-exclude-ud").is(":checked")&&node.getData("BeneficialOwnershipPercentage")==undefined&&node.getData("BeneficiaryIndicator")==true||pscNode){var list=paths[node.getId()];for(var key in list){if(ogma.getEdge(key)!=undefined){ogma.getEdge(key).getSource().setData("ndisplay","on");ogma.getEdge(key).getTarget().setData("ndisplay","on")}}}});ogma.getNodes("visible").forEach(function(node){if(node.getData("valueUndefined")){node.setData("BeneficialOwnershipPercentage",undefined)}});var count=0;ogma.getNodes("visible").forEach(function(node){if(node.getData("ndisplay")==="on"&&node.getData("DUNSNumber")!=targetDuns){count++}});if(count==0){$("#"+domKey+" #ubo-message").show();$("#"+domKey+" #ubo-message").html('<div class="ubo-filterError ubo-errorFading">'+ERROR_UG013+"</div>");return node.getData("DUNSNumber")===targetDuns||node.getData("ndisplay")==="on"}else{return node.getData("DUNSNumber")===targetDuns||node.getData("ndisplay")==="on"}});corporateFilter=ogma.transformations.addEdgeFilter(function(edge){var benPer,childNodeCnt=0;ogma.getNodes("all").forEach(function(node){var allBenNodes=[],largestBenPer1=0,largestBenPer2=0,largestBenPer=0;if(node.getData("pscCorpNodeIndicator")==true){ogma.getEdges("all").forEach(function(edge){if(node.getId()==edge.getData("SourceMemberID")){ogma.getNodes("all").forEach(function(node){if(edge.getTarget().getId()==node.getId()){allBenNodes.push(node)}})}});allBenNodes.forEach(function(e){if(e.getData("BeneficialOwnershipPercentage")!=undefined){if(largestBenPer1<parseFloat(e.getData("BeneficialOwnershipPercentage")))largestBenPer1=parseFloat(e.getData("BeneficialOwnershipPercentage"))}else{var nid=e.getId();largestBenPer2=getChildPercentage(nid,largestBenPer2)}if(largestBenPer1>largestBenPer2){largestBenPer=largestBenPer1}else{largestBenPer=largestBenPer2}});var list=paths[node.getId()];if(node.getData("BeneficialOwnershipPercentage")!=undefined){benPer=parseFloat(node.getData("BeneficialOwnershipPercentage"))}else{if(largestBenPer>0){benPer=largestBenPer}else{allBenNodes.forEach(function(e){if(e.getData("ndisplay")=="off")benPer=-1})}}if(benPer<amount||benPer==-1){for(var key in list){if(ogma.getEdge(key)!=undefined){if(ogma.getEdge(key).getData("ShareHoldingPercentage")!=undefined){ogma.getEdge(key).setData("ndisplay","off")}}}}}});return edge.getData("ndisplay")!="off"});setTimeout(function(){benFilter.whenApplied().then(function(){self.refreshLayout();setTimeout(function(){self.calculateCounts()},200)})},300)}};function getChildPercentage(nid,largestBenPer2){var arry=[];ogma.getEdges("all").forEach(function(edge){if(nid==edge.getData("SourceMemberID")){ogma.getNodes("all").forEach(function(node){if(edge.getTarget().getId()==node.getId()){arry.push(node)}})}});arry.forEach(function(a){if(a.getData("BeneficialOwnershipPercentage")!=undefined){if(largestBenPer2<parseFloat(a.getData("BeneficialOwnershipPercentage")))largestBenPer2=parseFloat(a.getData("BeneficialOwnershipPercentage"))}else{largestBenPer2=getChildPercentage(a.getId(),largestBenPer2)}});return largestBenPer2}this.refreshLayout=function(){if($("#"+domKey+" #ubo-leftViewController"+" #box-run-layout").is(":checked"))$(".ubo_CountHighlight").removeClass("bold");self.runLayout("forceLink").then(function(){self.calculateCounts()})};this.prepareFilters=function(){rels.forEach(function(e){paths[e[1]]=targetNode===e[1]?null:{};paths[e[2]]=targetNode===e[2]?null:{}});for(var i=0;i<15;i++){rels.forEach(function(e){var fro=e[1],to=e[2],fromVal=paths[e[1]],edgeId=e[0];if(fromVal==null){paths[to][edgeId]=0}else if(Object.keys(fromVal).length>0){paths[to]=$.extend({},paths[to],paths[fro]);paths[to][edgeId]=0}})}};var transformationList=[];this.groupSelection=function(selectedNodes,evt){var i=0,content,contentGroup=[],flag=false,isUndisclosedFlag=0,numberOfNodes,nameArray=[],iscountryEqual=true,countryCode,returnval;var hasPscMerged=false;selectedNodes.forEach(function(node){var duns=node.getData("DUNSNumber");var typeLegal=node.getData("SubjectTypeDescription.@DNBCodeValue");if(duns||node.getData("addedNode")||typeLegal==30912){flag=true;return}content=node.getAttribute("icon.content");if(contentGroup.length==0){contentGroup[++i]=content;countryCode=node.getData("PrimaryAddress.CountryISOAlpha2Code")}else{if(jQuery.inArray(content,contentGroup)!==-1){contentGroup[++i]=node.getAttribute("icon.content");if(countryCode!=node.getData("PrimaryAddress.CountryISOAlpha2Code")){iscountryEqual=false}}else{flag=true;return}}});if(selectedNodes.size<2||flag)return;var grouping=ogma.transformations.addNodeGrouping({selector:function(node){selectedNodes.forEach(function(node){node.getAdjacentEdges().forEach(function(edge){if(edge.getAttribute("color")=="orange"){ogma.removeEdge(edge)}})});return selectedNodes.includes(node)},nodeGenerator:function(nodes,groupId,ruleId){return{data:{BeneficialOwnershipPercentage:nodes.reduce(function(percent,node){if(node.getData("BeneficialOwnershipPercentage")===undefined&&evt!="null"){isUndisclosedFlag++}if(node.getData("BeneficialOwnershipPercentage")===undefined){percent=parseFloat(parseFloat(percent)).toFixed(2)}else{percent=parseFloat(parseFloat(percent)+parseFloat(node.getData("BeneficialOwnershipPercentage"))).toFixed(2)}if(isUndisclosedFlag==2){percent=undefined}returnval=percent;return returnval},0),BeneficiaryIndicator:true,SubjectTypeDescription:{"@DNBCodeValue":nodes.reduce(function(type,node){return node.getData("SubjectTypeDescription.@DNBCodeValue")},0)},NodeWithHasPsc:nodes.reduce(function(percent,node){node.getAdjacentEdges().forEach(function(edge){if(edge.getData("RelationshipTypeDescription.@DNBCodeValue")==33700){hasPscMerged=true}});if(hasPscMerged)return true;else return false}),PrimaryName:nodes.reduce(function(name,node){if(node.getData("groupFlag"))name=splitAndAppendString(node.getData("PrimaryName"),name,"nil","nil");else name=splitAndAppendString(node.getData("PrimaryName"),name,node.getData("BeneficialOwnershipPercentage"),node.getData("NatureOfControlClassDescription"));return name},0),PrimaryAddress:{CountryISOAlpha2Code:nodes.reduce(function(code,node){if(iscountryEqual==true){return node.getData("PrimaryAddress.CountryISOAlpha2Code")}else{return undefined}},0),CountryOfficialName:nodes.reduce(function(code,node){if(iscountryEqual==true){return node.getData("PrimaryAddress.CountryOfficialName")}else{return undefined}},0)},groupFlag:true,transformationId:ruleId,ndisplay:"off",valueUndefined:nodes.reduce(function(name,node){evt="null";if(isUndisclosedFlag==2)return true;else return false})}}},duration:300,groupEdges:false});transformationList.push(grouping);setTimeout(function(){grouping.whenApplied().then(function(){self.refreshLayout();self.calculateCounts()})},500)};this.setMaxBen=function(){MAX_BEN_PCT=0;ogma.getNodes("all").forEach(function(node){if(node.getData("BeneficialOwnershipPercentage")&&node.getData("BeneficialOwnershipPercentage")!=undefined){if(MAX_BEN_PCT<parseFloat(node.getData("BeneficialOwnershipPercentage"))){MAX_BEN_PCT=parseFloat(node.getData("BeneficialOwnershipPercentage"))}}})};$("#"+domKey+" #ubo-leftViewController"+" #ubo-slider").on("slide",function(event,ui){self.setMaxBen();if($("#"+domKey+"-searchDialog").is(":visible")){$("#"+domKey+"-searchDialog").hide()}clearNodeHeighlight(ogma);$("#"+domKey+" #ubo-leftViewController"+" #search").removeClass("ubo-acitonmenu-selected");if(ui.value>MAX_BEN_PCT)return false;else $("#"+domKey+" #ubo-leftViewController"+" #amount").val(ui.value)});$("#"+domKey+" #ubo-leftViewController"+" .ubo-menu-body h4").on("click",function(event,ui){event.preventDefault();if($(this).next().is(":visible")){$(this).find("i").remove();$(this).append('<i class="fa fa-angle-down"></i>');$(this).next().slideUp()}else{if($(this).attr("id")=="ubo-filter-expand"){if($("#"+domKey+" #ubo-leftViewController"+" #info-msg").is(":checked")){showToastMessages(TOAST_EXPAND_FILTER)}}$(this).parents(".ubo-menu-body").find(".ubo-menu-section-content").slideUp();$(this).parents(".ubo-menu-body").find("h4 i").remove();$(this).parents(".ubo-menu-body").find("h4").append('<i class="fa fa-angle-down"></i>');$(this).find("i").remove();$(this).append('<i class="fa fa-angle-up"></i>');$(this).next().slideDown()}});$("#"+domKey+" #ubo-leftViewController"+" .ubo-menu-body .innerAccordion").on("click",function(event,ui){event.preventDefault();if($(this).next().is(":visible")){$(this).find("i").remove();$(this).append('<i class="fa fa-plus-circle" aria-hidden="true"></i>');$(this).next().slideUp()}else{$(this).parents(".ubo-menu-body").find(".ubo-menu-section-innerAccordioncontent").slideUp();$(this).parents(".ubo-menu-body").find(".innerAccordion i").remove();$(this).parents(".ubo-menu-body").find(".innerAccordion").append('<i class="fa fa-plus-circle" aria-hidden="true"></i>');$(this).find("i").remove();$(this).append('<i class="fa fa-minus-circle" aria-hidden="true"></i>');$(this).next().slideDown()}});this.toggleLeftMenu=function(){$("#"+domKey+" #path-large-ben").prop("disabled",function(_,val){return!val});$("#"+domKey+" #ubo-viewController").find(">#toggleLeftMenu").toggleClass("ubo-selected");if(!CONTAIN_UNDISCLOSED){$("#"+domKey+" #ubo-leftViewController"+" #checkUndisclosed").hide()}else{$("#"+domKey+" #ubo-leftViewController"+" #ubo-filterBr").show()}$("#"+domKey+" #ubo-leftViewController"+" .ubo-slider-limit").css("left",Math.floor(MAX_BEN_PCT)+"%");if(!$("#"+domKey+" #ubo-leftViewController").is(":visible")&&!$("#"+domKey+" .ubo-ctrl-toggle-div").is(":visible")){$("#"+domKey+" .ubo-ctrl-toggle-div").slideDown(function(){$("#"+domKey+" #showControl").addClass("fa-angle-double-down");$("#"+domKey+" #ubo-leftViewController").toggle("slide")})}else{$("#"+domKey+" #ubo-leftViewController").toggle("slide")}$("#"+domKey+" #ubo-leftViewController"+" #ubo-slider").slider({min:0,max:100});var benCount=0;ogma.getNodes().forEach(function(node){if(node.getData("BeneficiaryIndicator")){benCount++;return}});if(benCount==0){$("#"+domKey+" #ubo-leftViewController"+" #ubo-slider").slider({disabled:true});$("#"+domKey+" #ubo-leftViewController"+" #box-exclude-ud").prop({disabled:true})}self.prepareFilters();ogma.clearSelection()};this.showControls=function(){if($("#"+domKey+" #ubo-leftViewController").is(":visible")&&$("#"+domKey+" .ubo-ctrl-toggle-div").is(":visible")){$("#"+domKey+" #ubo-leftViewController").toggle("slide",function(){$("#"+domKey+" .ubo-ctrl-toggle-div").slideToggle()});$("#"+domKey+" #ubo-viewController").find(">#toggleLeftMenu").toggleClass("ubo-selected")}else{$("#"+domKey+" .ubo-ctrl-toggle-div").slideToggle()}$("#"+domKey+" #showControl").toggleClass("fa-angle-double-down")};this.toggleLegend=function(){$("#"+domKey+" #ubo-legend").slideToggle("fast","swing")};this.togglePulse=function(){if(toggler.pulse){ogma.getNode(targetNode).pulse(PULSE_OPTIONS);toggler.pulseId=setInterval(function(){ogma.getNode(targetNode).pulse(PULSE_OPTIONS)},5e3);toggler.pulse=!toggler.pulse}else{clearInterval(toggler.pulseId);toggler.pulse=!toggler.pulse}};this.zoomReset=function(){ogma.view.locateGraph({easing:"linear",duration:300})};this.exportImage=function(){var fileName="D&BOwnershipStructure_"+targetDuns+"_"+getCurrentDate()+".png";if($("#"+domKey+" #ubo-leftViewController"+" #info-msg").is(":checked")){showToastMessages(fileName+TOAST_EXPORT_PNG)}ogma.export.png({download:true,background:"white",filename:fileName,texts:true,clip:true})};this.changeEdgeStyle=function(){if(toggler.arrow){ogma.getEdges("all").setAttributes({shape:"tapered"});toggler.arrow=!toggler.arrow}else{ogma.getEdges("all").setAttributes({shape:"arrow"});toggler.arrow=!toggler.arrow}};this.toggleNodeText=function(){if(toggler.label){self.applyNodeTextRule(false);self.applyEdgeTextRule(false);ogma.styles.setEdgeTextsVisibility(false);toggler.label=!toggler.label}else{self.applyNodeTextRule(true);self.applyEdgeTextRule(true);ogma.styles.setEdgeTextsVisibility(true);toggler.label=!toggler.label}};this.zoomIn=function(){ogma.view.zoomIn({duration:200})};this.zoomOut=function(){ogma.view.zoomOut({duration:200})};this.locateRandomNode=function(){ogma.getNode(targetNode).locate({duration:600})};this.rotateLeft=function(){ogma.view.rotate(Math.PI/2,{duration:600})};this.rotateRight=function(){ogma.view.rotate(-Math.PI/2,{duration:600})};this.changeLayout=function(){var s=["hierarchical","grid","radial","concentric","forceLink"],l=s[uboLayout++%s.length];if($("#"+domKey+" #ubo-leftViewController"+" #info-msg").is(":checked")){if(l=="hierarchical"){showToastMessages(TOAST_HIERARCHICAL)}else if(l=="grid"){showToastMessages(TOAST_GRID)}else if(l=="radial"){showToastMessages(TOAST_RADIAL)}else if(l=="concentric"){showToastMessages(TOAST_CONCENTRIC)}else if(l=="forceLink"){showToastMessages(TOAST_FORCELINK)}}self.runLayout(l)};this.fullScreen=function(){$("#"+domKey+" #graph-fullScreen").toggleClass("fa-expand fa-compress");if(ogma.view.isFullScreen()){ogma.view.setFullScreen(false);$("button#fullScreen").attr("title","Full screen")}else{ogma.view.setFullScreen(true);$("button#fullScreen").attr("title","Normal mode")}};this.help=function(){var helpHt=parentHt*.8;var helpWd=parentWd*.7;var dialog;var lang=HELP_LANG;var helpObj,dialogTitle;var getHelp=function(data){helpObj=data;dialogTitle=helpObj["ubo-graphHelp"].title[lang]};$.getJSON(UBO_RESOURCE_URL+"/misc/ubo-i18n.json",getHelp).then(function(){dialog=$("#"+domKey+"-dialog-help").dialog({height:helpHt,width:helpWd,modal:true,title:dialogTitle,resizable:false,close:function(event,ui){$(this).dialog("destroy")}});if($("#"+domKey).find("canvas").width()>1200){$(".ui-widget-overlay").appendTo("#"+domKey);$("#"+domKey+"-dialog-help").parent().appendTo("#"+domKey)}$("#"+domKey+"-dialog-help").parent().position({of:window});$("#"+domKey+"-dialog-help").parent().addClass("ubo-dialog-box");$("#"+domKey+"-dialog-help").parents(".ubo-dialog-box").find(".ui-dialog-title").before('<img src="'+UBO_RESOURCE_URL+"/"+'img/dnb_logo.png"'+' width="18px" height="" valign="middle"/>');$("#"+domKey+"-dialog-help").parents(".ubo-dialog-box").find(".ui-dialog-titlebar-close").attr("title","Close");$("#"+domKey+"-dialog-help").parents(".ubo-dialog-box").find(".ui-dialog-titlebar-close").find("span").remove();$("#"+domKey+"-dialog-help").parents(".ubo-dialog-box").find(".ui-dialog-titlebar-close").find("i").remove();$("#"+domKey+"-dialog-help").parents(".ubo-dialog-box").find(".ui-dialog-titlebar-close").append('<i class="fa fa-times" aria-hidden="true"></i>');changeLanguage(lang,helpObj)});collapseAll();$("#"+domKey+"-dialog-help").find(".ubo-helpTitleSection ul li").unbind().on("click",function(e){e.stopPropagation();$("#"+domKey+"-dialog-help").find(".ubo-helpDetailSection").find(".ubo-breadcrumb").empty();$("#"+domKey+"-dialog-help").find(".ubo-helpDetailSection").find(".ubo-breadcrumb").append("<span>"+$(this).find(">span").text()+"</span>");var $this=$(this).find(">ul");if($this.length>0){if($this.is(":visible")){$this.slideUp();$(this).find(">span>i").remove();$(this).find(">span").prepend('<i class="fa fa-plus-square-o"></i>')}else{$("#"+domKey+"-dialog-help").find(".ubo-helpTitleSection ul li ul").hide();$("#"+domKey+"-dialog-help").find(".ubo-helpTitleSection>ul>li>span").find("i").remove();$("#"+domKey+"-dialog-help").find(".ubo-helpTitleSection>ul>li>span").prepend('<i class="fa fa-plus-square-o"></i>');$(this).find(">span>i").remove();$(this).find(">span").prepend('<i class="fa fa-minus-square-o"></i>');$this.slideDown()}}$("#"+domKey+"-dialog-help").find(".ubo-helpTitleSection ul li").removeClass("selected");$(this).addClass("selected");var divId="#"+$(this).attr("id")+"_Div";$("div.ubo-helpDetailsDiv").hide();if($(divId).length){$("#"+domKey+"-dialog-help").find(".ubo-helpDetailSection").find(divId).show()}else{$("div#ubo-titleHelp_Div").show()}})};function changeLanguage(lang,helpObj){$(".ubo-detailsWrap").find(".ubo-helpDetailsDiv:first-child p").text(helpObj["ubo-graphHelp"].description[lang]);$(".ubo-detailsWrap").find("#ubo-titleHelp_Div p").text(helpObj["ubo-graphCtrlshelp"].description[lang]);for(var key in helpObj){if(typeof helpObj[key]=="object"){if($("#"+key).length){$("#"+key+" span:first-child label").text(helpObj[key].title[lang]);$("#"+key+"_Div"+" p").text(helpObj[key].description[lang])}}}}function collapseAll(){$("#"+domKey+"-dialog-help").find(".ubo-helpTitleSection ul li ul").hide();$("#"+domKey+"-dialog-help").find(".ubo-helpTitleSection>ul>li>span").find("i").remove();$("#"+domKey+"-dialog-help").find(".ubo-helpTitleSection>ul>li>span").prepend('<i class="fa fa-plus-square-o"></i>');$("div.ubo-helpDetailsDiv").hide();$("div.ubo-detailsWrap").find(".ubo-helpDetailsDiv:first-child").show();$("#"+domKey+"-dialog-help").find(".ubo-helpDetailSection").find(".ubo-breadcrumb").empty()}var timeOut;function showToastMessages(message){clearTimeout(timeOut);$("#"+domKey+" #ubo-toast-message").css("opacity",0);$("#"+domKey+" #ubo-toast-message").html('<div class="ubo-toastError"><i class="fa fa-info-circle" aria-hidden="true"></i>'+message+'<span id="toast-close" title="close"><i class="fa fa-times" aria-hidden="true"></i></span></div>');if($("#"+domKey+" #ubo-leftViewController").is(":visible")){$(".ubo-toastError").css("margin-left","25%")}else{$(".ubo-toastError").css("margin-left","0")}$("#"+domKey+" #ubo-toast-message").show();$("#"+domKey+" #ubo-toast-message").animate({opacity:1},1e3,callback)}function shownNoOwnershipMessages(message){$("#"+domKey+" #ubo-toast-message").show();$("#"+domKey+" #ubo-toast-message").html('<div class="ubo-noOwnership">'+message+'<span id="toast-close" class="ubo-noownership-close" title="close"><span><i class="fa fa-times" aria-hidden="true"></i></span></div>')}function callback(){timeOut=setTimeout(function(){$("#"+domKey+" #ubo-toast-message").fadeOut("slow")},1e3)}this.pathFinder=function(source,target){var pathNodes=ogma.pathfinding.astar(source,target);if(pathNodes){var ids=pathNodes.getId();pathNodes.forEach(function(node){node.getAdjacentEdges().forEach(function(edge){if(ids.indexOf(edge.getSource().getId())!=-1&&ids.indexOf(edge.getTarget().getId())!=-1){edge.setSelected(true)}})})}};this.removeNewNodes=function(){ogma.getNodes().forEach(function(node){if(node.getData("addedNode")){ogma.removeNode(node)}})};this.removeNewEdges=function(){ogma.getEdges().forEach(function(e){if(e.getAttribute("color")==="orange"){ogma.removeEdge(e)}})};this.applyCss=function(){if($("#"+domKey+" #ubo-leftViewController"+" #nodeLabel").css("background-color")=="rgb(33, 149, 123)"){$("#"+domKey+" #ubo-leftViewController"+" #nodeLabel").css("background-color","white")}};this.getLargestBen=function(){if(ogma.getSelectedEdges().size>0){ogma.clearSelection()}else{var mergeNodes=0;ogma.getNodes("visible").forEach(function(node){if(node.getData("groupFlag")==true){mergeNodes++}});if(mergeNodes==0){var max_pct=0,count=0,selNode;ogma.getNodes().forEach(function(node){if(node.getData("BeneficialOwnershipPercentage")!=undefined){if(max_pct<parseFloat(node.getData("BeneficialOwnershipPercentage")))max_pct=parseFloat(node.getData("BeneficialOwnershipPercentage"))}});ogma.getNodes().forEach(function(node){if(node.getData("BeneficialOwnershipPercentage")!=undefined&&parseFloat(node.getData("BeneficialOwnershipPercentage"))==max_pct){count++;selNode=node}});if(count==1){self.pathFinder(targetNode,selNode)}else{if(this.id=="path-large-ben"){showToastMessages(TOAST_PATH_LRG_BEN)}}}else{showToastMessages(TOAST_MERGE_NODE_PRESENT)}}};this.clear=function(){$("#"+domKey+" #ubo-leftViewController"+" #ubo-slider").slider("value",0);$("#"+domKey+" #ubo-leftViewController"+" #amount").val(0);$("#"+domKey+" #ubo-leftViewController"+" #box-exclude-ud").prop("checked",true);$("#"+domKey+" #ubo-leftViewController"+" #box-run-layout").prop("checked",true);$("#"+domKey+" #ubo-leftViewController"+" #show-psc").prop("checked",true);$("#"+domKey+" #ubo-leftViewController"+" #info-msg").prop("checked",false);$("#"+domKey+" #ubo-leftViewController"+" #merge").css("background","white");$("#"+domKey+" #ubo-leftViewController"+" #merge").prop("disabled",false);$("#"+domKey+"-uboIndAdd").prop("checked",false);$("#"+domKey+"-uboIndDOB").prop("checked",false);$("#"+domKey+"-uboindDoNOC").prop("checked",false);$("#"+domKey+"-uboindNOC").prop("checked",false);$("#"+domKey+"-uboindNationality").prop("checked",false);$("#"+domKey+"-uboindCtryRes").prop("checked",false);$("#"+domKey+"-uboentNOC").prop("checked",false);$("#"+domKey+"-uboentDoNOC").prop("checked",false);$("#"+domKey+"-uboentLegAuth").prop("checked",false);$("#"+domKey+"-uboentLegForm").prop("checked",false);$("#"+domKey+"-uboorgNOC").prop("checked",false);$("#"+domKey+"-uboorgDoNOC").prop("checked",false);$("#"+domKey+"-uboEntAdd").prop("checked",false);$("#"+domKey+"-uboEntCountry").prop("checked",false);$("#"+domKey+"-uboDuns").prop("checked",false);$("#"+domKey+"-uboOrgcountry").prop("checked",false);$("#"+domKey+"-uboControlType").prop("checked",false);$("#"+domKey+"-uboLegalForm").prop("checked",false);$("#"+domKey+"-uboOrgAddress").prop("checked",false);$("#"+domKey+" #ubo-leftViewController"+" #addNode").css("background","white");$("#"+domKey+" #ubo-leftViewController"+" #addNode").prop("disabled",false);$("#"+domKey+" #ubo-leftViewController"+" #createNode").css("background","white");$("#"+domKey+" #ubo-leftViewController"+" #createNode").prop("disabled",false);$("#"+domKey+" #ubo-leftViewController"+" #createRel").css("background","white");$("#"+domKey+" #ubo-leftViewController"+" #createRel").prop("disabled",false);$("#"+domKey+" #ubo-message").hide();self.removeNewNodes();self.removeNewEdges();var promise=Promise.all(ogma.transformations.getList().filter(function(transformation){return transformation.getName()==="node-grouping"}).map(function(transformation){return transformation.destroy()}));$("#show-psc").change();self.clearAllNodeLabels();self.applyCss();self.calculateCounts()};$("#"+domKey+" #ubo-leftViewController",function(){$("#show-psc").on("change",function(){$(".ubo_CountHighlight").removeClass("bold");if($(this).is(":checked")){if(pscEdgeFilter!=undefined){pscEdgeFilter.destroy();pscEdgeFilter=undefined}if(pscNodeFilter!=undefined){pscNodeFilter.destroy();pscNodeFilter=undefined}}else{ogma.getNodes("all").forEach(function(node){if(node.getData("NodeWithHasPsc")==true){var transformationId=node.getData("transformationId");transformationId.destroy(300).then(function(){self.applyNodeSecondaryTextRule();setTimeout(function(){self.calculateCounts()},400)})}});pscNodeFilter=ogma.transformations.addNodeFilter(function(node){var pscNode=[];var benNode=[];ogma.getEdges("visible").forEach(function(edge){if(edge.getData("RelationshipTypeDescription.@DNBCodeValue")==33700){pscNode.push(edge.getData("TargetMemberID"))}else if(edge.getData("RelationshipTypeDescription.@DNBCodeValue")==137||edge.getData("RelationshipTypeDescription.@DNBCodeValue")==1012){benNode.push(edge.getData("TargetMemberID"))}for(var i=0;i<benNode.length;i++){var arrlen=pscNode.length;for(var j=0;j<arrlen;j++){if(benNode[i]==pscNode[j]){pscNode=pscNode.slice(0,j).concat(pscNode.slice(j+1,arrlen))}}}});return!pscNode.includes(node.getData("MemberID"))});pscEdgeFilter=ogma.transformations.addEdgeFilter(function(edge){return edge.getData("RelationshipTypeDescription.@DNBCodeValue")!=33700})}setTimeout(function(){self.refreshLayout();self.calculateCounts()},100)})});$("#"+domKey+" #ubo-leftViewController",function(){$(".ubo_CountHighlight").on("click",function(e){$("#"+domKey+" #ubo-leftViewController"+" .ubo-acitonmenu").removeClass("ubo-acitonmenu-selected");var countText=$(this).text();var resultFound=0;if($(this).attr("class")!="ubo_CountHighlight bold"){clearNodeHeighlight(ogma);$(".ubo_CountHighlight").removeClass("bold");$(this).toggleClass("bold");var countType=$(this).data("namecount");var pscNodes=[],shbNodes=[];ogma.getEdges("visible").forEach(function(edge){if(edge.getData("RelationshipTypeDescription.@DNBCodeValue")==33700){pscNodes.push(edge.getData("TargetMemberID"))}else{shbNodes.push(edge.getData("TargetMemberID"))}});ogma.getNodes("visible").forEach(function(n){if(n.getAttribute("opacity")===1){var flag=0;var type=n.getData("SubjectTypeDescription.@DNBCodeValue"),duns=n.getData("DUNSNumber");if(duns===targetDuns){flag=0}else{if($.inArray(n.getData("MemberID"),pscNodes)!=-1&&countType.indexOf("pscCount")!=-1){if(duns&&countText.indexOf("Organisation")!=-1){flag=1}else if(type==119&&countText.indexOf("Individual")!=-1){flag=1}else if(type==30912&&countText.indexOf("Legally Withheld")!=-1){flag=1}else if(type==118&&countText.indexOf("Entity")!=-1&&!duns){flag=1}else{flag=0}}else if($.inArray(n.getData("MemberID"),shbNodes)!=-1&&countType.indexOf("benCount")!=-1){if(duns&&n.getData("OutofBusinessIndicator")==true&countText.indexOf("OOB")!=-1){flag=1}else{flag=0;if(duns&&n.getData("OutofBusinessIndicator")!=true&&countText.indexOf("Organisation")!=-1){flag=1}else{if(type==119&&countText.indexOf("Individual")!=-1){flag=1}else if(type==undefined&&countText.indexOf("Entity")!=-1){flag=1}}}}else{flag=0}}if(flag==1){resultFound=1;n.setAttributes({halo:{color:"#82CFFD",size:5,strokeColor:"#A3DCFE",strokeWidth:2},outerStroke:{color:"#ff756e",width:2}},{duration:500})}}});if(resultFound==1){ogma.getNodes("visible").forEach(function(n){if(n.getAttribute("opacity")===1){var flag=1;var type=n.getData("SubjectTypeDescription.@DNBCodeValue"),duns=n.getData("DUNSNumber");if(duns===targetDuns){flag=0}else{if($.inArray(n.getData("MemberID"),pscNodes)!=-1&&countType.indexOf("pscCount")!=-1){if(duns&&countText.indexOf("Organisation")!=-1){flag=1}else if(type==119&&countText.indexOf("Individual")!=-1){flag=1}else if(type==30912&&countText.indexOf("Legally Withheld")!=-1){flag=1}else if(type==118&&countText.indexOf("Entity")!=-1&&!duns){flag=1}else{flag=0}}else if($.inArray(n.getData("MemberID"),shbNodes)!=-1&&countType.indexOf("benCount")!=-1){if(duns&&n.getData("OutofBusinessIndicator")==true&countText.indexOf("OOB")!=-1){flag=1}else{flag=0;if(duns&&n.getData("OutofBusinessIndicator")!=true&&countText.indexOf("Organisation")!=-1){flag=1}else{if(type==119&&countText.indexOf("Individual")!=-1){flag=1}else if(type==undefined&&countText.indexOf("Entity")!=-1){flag=1}}}}else{flag=0}}if(flag==0){n.setAttributes({opacity:.3},{duration:500})}}});ogma.getEdges("all").setAttributes({opacity:.3})}}else{clearNodeHeighlight(ogma);$(".ubo_CountHighlight").removeClass("bold")}})});$("#"+domKey+" #ubo-leftViewController"+" #info-msg").on("click",function(){$(".ubo_CountHighlight").removeClass("bold")});$(document).ready(function(){$(document).on("click","#"+domKey+" #ubo-leftViewController"+" .ubo-acitonmenu",function(){var id=$(this).attr("id");if(id=="btnReset"){$("#"+domKey+" #ubo-leftViewController"+" .ubo-acitonmenu").removeClass("ubo-acitonmenu-selected")}else{$("#"+domKey+" #ubo-leftViewController"+" .ubo-acitonmenu").removeClass("ubo-acitonmenu-selected");$(this).addClass("ubo-acitonmenu-selected");if(id=="merge"){$(".ubo_CountHighlight").removeClass("bold");clearNodeHeighlight(ogma);if($("#"+domKey+" #ubo-leftViewController"+" #info-msg").is(":checked")){showToastMessages(TOAST_MERGE_NODE)}self.applyNodeSecondaryTextRule()}if($("#"+domKey+" #ubo-leftViewController"+" #info-msg").is(":checked")){if(id=="addNode"){showToastMessages(TOAST_ADD_NODE)}if(id=="nodeLabel"){showToastMessages(TOAST_CONFIG_NODE)}}}if(id=="search"){}else{if($("#"+domKey+"-searchDialog").is(":visible")){$("#"+domKey+"-searchDialog").hide()}clearNodeHeighlight(ogma)}});$("#"+domKey+" #ubo-leftViewController"+" input").on("click",function(){if($("#"+domKey+"-searchDialog").is(":visible")){$("#"+domKey+"-searchDialog").hide()}clearNodeHeighlight(ogma);$("#"+domKey+" #ubo-leftViewController"+" #search").removeClass("ubo-acitonmenu-selected")});$(document).on("click","#"+domKey+" #toast-close",function(){$(this).parents().find("#"+domKey+" #ubo-toast-message").hide()})});$("#"+domKey+" #ubo-leftViewController"+" #nodeLabel").unbind("click").click(function(e){$(".ubo_CountHighlight").removeClass("bold");var dialog,form;dialog=$("#"+domKey+"-nodeLabeldialog").dialog({height:500,width:600,modal:true,title:"Additional Labels",position:{at:"center",of:$("#"+domKey),collision:"fit"},buttons:[{text:"Close",click:function(){$(this).dialog("destroy");$("#"+domKey+" #ubo-leftViewController"+" #nodeLabel").removeClass("ubo-acitonmenu-selected");self.applyCss()},style:"background:rgb(33, 149, 123);color:white"},{text:"OK",style:"margin-right:25px;background:rgb(33, 149, 123);color:white",click:function(){self.applyNodeSecondaryTextRule();$("#"+domKey+" #ubo-leftViewController"+" #nodeLabel").removeClass("ubo-acitonmenu-selected");self.applyCss();$(this).dialog("destroy")}}],close:function(event,ui){$("#"+domKey+" #ubo-leftViewController"+" #nodeLabel").removeClass("ubo-acitonmenu-selected");$(this).dialog("destroy")}});if($("#"+domKey).find("canvas").width()>1200){$(".ui-widget-overlay").appendTo("#"+domKey);$("#"+domKey+"-nodeLabeldialog").parent().appendTo("#"+domKey)}$("#"+domKey+"-nodeLabeldialog").parent().position({of:window});$("#"+domKey+"-nodeLabeldialog").parents(".ui-dialog").find(".ui-dialog-titlebar-close").attr("title","Close")});var type,availableList=[];$("#"+domKey+" #ubo-leftViewController"+" #search").unbind("click").click(function(e){clearNodeHeighlight(ogma);$(".ubo_CountHighlight").removeClass("bold");$("#"+domKey+"-searchDialog").show();self.initializeSearch();$("#"+domKey+" .ubo-search-criteria").unbind("click").click(function(e){$(this).parents(".ubo-search-box").find(".ubo-criteria-options").toggle()});$("#"+domKey+" .ubo-criteria-options>span").unbind("click").click(function(e){$(this).parents(".ubo-search-box").find(".ubo-selected-criteria").text($(this).text());$("#"+domKey+" .ubo-criteria-options>span").removeClass("ubo-selectedCr");$(this).addClass("ubo-selectedCr");$(this).parents(".ubo-search-box").find(".ubo-criteria-options").hide();type=$("#"+domKey+" .ubo-criteria-options").find(".ubo-selectedCr").attr("id");availableList=[];ogma.getNodes("visible").forEach(function(n){if(type=="byDuns"){if(n.getData("DUNSNumber")==undefined){}else{if($.inArray(n.getData("DUNSNumber"),availableList)==-1){availableList.push(n.getData("DUNSNumber"))}}}else if(type=="byName"){if(n.getData("PrimaryName")==undefined){if(n.getData("SubjectTypeDescription.@DNBCodeValue")==30912){availableList.push("SUPER SECURED")}}else{if($.inArray(n.getData("PrimaryName"),availableList)==-1){availableList.push(n.getData("PrimaryName"))}}}else{if(n.getData("PrimaryAddress.CountryOfficialName")==undefined){}else{if($.inArray(n.getData("PrimaryAddress.CountryOfficialName"),availableList)==-1){availableList.push(n.getData("PrimaryAddress.CountryOfficialName"))}}}});$("#"+domKey+" .ubo-seach-input").val("").focus()});$("#"+domKey+" .ubo-seach-input").on("keydown",function(event){if(event.keyCode===$.ui.keyCode.TAB&&$(this).autocomplete("instance").menu.active){event.preventDefault()}}).autocomplete({enable:true,delay:300,minLength:0,source:function(request,response){response($.ui.autocomplete.filter(availableList,extractLast(request.term)))},focus:function(e,ui){return false},select:function(event,ui){var terms=split(this.value);terms.pop();terms.push(ui.item.value);terms.push("");this.value=terms.join("; ");return false},appendTo:$("#"+domKey)});$("#"+domKey+" .ubo-search-btn").unbind("click").click(function(e){self.searchNodes();$("#"+domKey+" .ubo-seach-input").focus().val($("#"+domKey+" .ubo-seach-input").val())});$("#"+domKey+" .ubo-clearSearch").unbind("click").click(function(e){self.initializeSearch();clearNodeHeighlight(ogma)});$(document).keypress(function(e){if(e.which==13){self.searchNodes();return false}});$(document).click(function(evt){if(evt.target.id=="ubo-criteria-options"||evt.target.id=="ubo-search-criteria")return;if($(evt.target).closest("#ubo-search-criteria").length)return;if($(evt.target).closest("#ubo-criteria-options").length)return;$("#ubo-criteria-options").hide()});$("#"+domKey+" .ubo-search-close").unbind("click").click(function(e){$("#"+domKey+" #ubo-leftViewController"+" #search").removeClass("ubo-acitonmenu-selected");$("#"+domKey+" .ubo-seach-input").val("");$("#"+domKey+" .ubo-errMsg").text("");clearNodeHeighlight(ogma);$("#"+domKey+"-searchDialog").hide()});dragElement(document.getElementById(domKey+"-searchDialog"));function dragElement(elmnt){var pos1=0,pos2=0,pos3=0,pos4=0;if(document.getElementById("ubo-search-header")){document.getElementById("ubo-search-header").onmousedown=dragMouseDown}else{elmnt.onmousedown=dragMouseDown}function dragMouseDown(e){e=e||window.event;pos3=e.clientX;pos4=e.clientY;document.onmouseup=closeDragElement;document.onmousemove=elementDrag}function elementDrag(e){e=e||window.event;pos1=pos3-e.clientX;pos2=pos4-e.clientY;pos3=e.clientX;pos4=e.clientY;elmnt.style.top=elmnt.offsetTop-pos2+"px";elmnt.style.left=elmnt.offsetLeft-pos1+"px"}function closeDragElement(){document.onmouseup=null;document.onmousemove=null}}});this.initializeSearch=function(){type="byName";availableList=[];$("#"+domKey+" .ubo-seach-input").val("");$("#"+domKey+" .ubo-errMsg").text("");$("#"+domKey+" .ubo-search-box").find(".ubo-selected-criteria").text("Name");$("#"+domKey+" .ubo-criteria-options>span").removeClass("ubo-selectedCr");$("#"+domKey+" .ubo-criteria-options>span:first-child").addClass("ubo-selectedCr");ogma.getNodes("visible").forEach(function(n){if(type=="byName"){if(n.getData("PrimaryName")==undefined){if(n.getData("SubjectTypeDescription.@DNBCodeValue")==30912){availableList.push("SUPER SECURED")}}else{if($.inArray(n.getData("PrimaryName"),availableList)==-1){availableList.push(n.getData("PrimaryName"))}}}})};this.searchNodes=function(){var searchString=$("#"+domKey+" .ubo-seach-input").val();$("#"+domKey).find(".ubo-errMsg").text("");if(searchString==""){$("#"+domKey).find(".ubo-errMsg").text(ERROR_NO_SEARCH_INPUT)}else{var searchStringList=searchString.split("; ");clearNodeHeighlight(ogma);var type=$("#"+domKey+" .ubo-criteria-options").find(".ubo-selectedCr").attr("id");var resultFound=0;ogma.getNodes("visible").forEach(function(n){if(n.getData("SubjectTypeDescription.@DNBCodeValue")==30912){n.setData("PrimaryName","SUPER SECURED")}if(n.getAttribute("opacity")===1){var flag=0;if(type=="byName"){if(n.getData("PrimaryName")!=undefined){searchStringList=$.map(searchStringList,function(n,i){return n.toLowerCase()});var name=$.trim(n.getData("PrimaryName")).replace(/[\t\n]+/g,"").toLowerCase();if($.inArray(name,searchStringList)==-1){flag=0}else{flag=1}}else{flag=0}}else if(type=="byDuns"){if(n.getData("DUNSNumber")!=undefined){if($.inArray(n.getData("DUNSNumber"),searchStringList)==-1){flag=0}else{flag=1}}else{flag=0}}else if(type=="byCountry"){if(n.getData("PrimaryAddress.CountryOfficialName")!=undefined){searchStringList=$.map(searchStringList,function(n,i){return n.toLowerCase()});if($.inArray(n.getData("PrimaryAddress.CountryOfficialName").toLowerCase(),searchStringList)==-1){flag=0}else{flag=1}}else{flag=0}}if(flag==1){resultFound=1;n.setAttributes({halo:{color:"#82CFFD",size:5,strokeColor:"#A3DCFE",strokeWidth:2},outerStroke:{color:"#ff756e",width:2}},{duration:500})}}});if(resultFound==1){ogma.getNodes("visible").forEach(function(n){if(n.getAttribute("opacity")===1){var flag=1;if(type=="byName"){if(n.getData("PrimaryName")!=undefined){searchStringList=$.map(searchStringList,function(n,i){return n.toLowerCase()});var name=$.trim(n.getData("PrimaryName")).replace(/[\t\n]+/g,"").toLowerCase();if($.inArray(name,searchStringList)==-1){flag=0}else{flag=1}}else{flag=0}}else if(type=="byDuns"){if(n.getData("DUNSNumber")!=undefined){if($.inArray(n.getData("DUNSNumber"),searchStringList)==-1){flag=0}else{flag=1}}else{flag=0}}else if(type=="byCountry"){if(n.getData("PrimaryAddress.CountryOfficialName")!=undefined){searchStringList=$.map(searchStringList,function(n,i){return n.toLowerCase()});if($.inArray(n.getData("PrimaryAddress.CountryOfficialName").toLowerCase(),searchStringList)==-1){flag=0}else{flag=1}}else{flag=0}}if(flag==0){n.setAttributes({opacity:.3},{duration:500})}}});ogma.getEdges("all").setAttributes({opacity:.3})}else{$("#"+domKey).find(".ubo-errMsg").text(ERROR_NO_SEARCH_RESULTS)}}};this.calculateCounts=function(){var orgCount=0,individualCount=0,entityCount=0,oobCount=0,ctryArray=[],pscOrgCount=0,pscIndividualCount=0,pscEntityCount=0,superSecureCount=0,soeStateCount=0,soeGovCount=0,soePublicCount=0,soePrivateCount=0;var pscNodes=[],shbNodes=[];ogma.getEdges("visible").forEach(function(edge){if(edge.getData("RelationshipTypeDescription.@DNBCodeValue")==33700){pscNodes.push(edge.getTarget().getId())}else{shbNodes.push(edge.getTarget().getId())}});ogma.getNodes("visible").forEach(function(n){if(n.getAttribute("opacity")===1){var type=n.getData("SubjectTypeDescription.@DNBCodeValue"),duns=n.getData("DUNSNumber");if(duns===targetDuns){}else{if(duns&&n.getData("OutofBusinessIndicator")==true){oobCount++}else{if(duns){if($.inArray(n.getId(),pscNodes)!=-1){pscOrgCount++}if($.inArray(n.getId(),pscNodes)!=-1&&$.inArray(n.getId(),shbNodes)!=-1){orgCount++}else if($.inArray(n.getId(),shbNodes)!=-1){orgCount++}if(n.getData("ControlOwnershipTypeText.$")!=null&&n.getData("ControlOwnershipTypeText.$")!=undefined){if(n.getData("ControlOwnershipTypeText.@DNBCodeValue")==9059){soeStateCount++}else if(n.getData("ControlOwnershipTypeText.@DNBCodeValue")==32495){soeGovCount++}else if(n.getData("ControlOwnershipTypeText.@DNBCodeValue")==9057){soePublicCount++}else if(n.getData("ControlOwnershipTypeText.@DNBCodeValue")==9058){soePrivateCount++}}}else{if(type==119){if($.inArray(n.getId(),pscNodes)!=-1&&$.inArray(n.getId(),shbNodes)!=-1){pscIndividualCount++;individualCount++}else if($.inArray(n.getId(),pscNodes)!=-1){pscIndividualCount++}else{individualCount++}}else if(type===30912){superSecureCount++}else{if($.inArray(n.getId(),pscNodes)!=-1&&$.inArray(n.getId(),shbNodes)!=-1){pscEntityCount++;entityCount++}else if($.inArray(n.getId(),pscNodes)!=-1){pscEntityCount++}else{entityCount++}}}}var ctry=n.getData("PrimaryAddress.CountryISOAlpha2Code"),ctryName=n.getData("PrimaryAddress.CountryOfficialName");if(ctry==undefined){ctry="unknown";ctryName="Unknown"}if(ctry=="HK"||ctry=="MO"){ctryName=n.getData("PrimaryAddress.CountryOfficialName")+" SAR"}else if(ctry=="TW"){ctryName=n.getData("PrimaryAddress.CountryOfficialName")+" Region"}if(ctry=="HK"||ctry=="MO"||ctry=="TW")ctryArray.push(["grey",ctryName]);else ctryArray.push([ctry,ctryName])}}});var occurrences={};for(var i=0,j=ctryArray.length;i<j;i++){occurrences[ctryArray[i]]=(occurrences[ctryArray[i]]||0)+1}var sortedCtryList=sortObject(occurrences);var ctrLimit=0,unknownCount=0;$("#"+domKey).find(".ubo-countryCountWrap").empty();$.each(sortedCtryList,function(key,value){if(ctrLimit<5){var ctryCode=key.substr(0,key.indexOf(","));var ctryName=key.substr(key.indexOf(",")+1);if(ctryCode=="unknown"){unknownCount=value}else{$("#"+domKey).find(".ubo-countryCountWrap").append('<div class="ubo-countWrap"><img src="'+UBO_RESOURCE_URL+"/"+"img/flag/"+ctryCode.toLowerCase()+'.png"'+' width="18px" height="17px"/><span class="ubo-countText">'+ctryName+'</span><span>:</span> <span class="ubo-count">'+value+"</span></div> ");$("#"+domKey).find(".ubo-view-more").hide()}}else{$("#"+domKey).find(".ubo-view-more").show();return false}ctrLimit=$("#"+domKey).find(".ubo-countryCountWrap").find(".ubo-countWrap").length});if(unknownCount>0&&ctrLimit<5){$("#"+domKey).find(".ubo-countryCountWrap").append('<div class="ubo-countWrap"><img src="'+UBO_RESOURCE_URL+"/"+'img/flag/unknown.png"'+' width="18px" height="17px"/><span class="ubo-countText">Unknown</span><span>:</span> <span class="ubo-count">'+unknownCount+"</span></div> ")}$("#"+domKey).find(".ubo-orgCount .ubo-count").text(orgCount);$("#"+domKey).find(".ubo-entityCount .ubo-count").text(entityCount);$("#"+domKey).find(".ubo-individualCount .ubo-count").text(individualCount);$("#"+domKey).find(".ubo-oobCount .ubo-count").text(oobCount);$("#"+domKey).find(".ubo-pscOrgCount .ubo-count").text(pscOrgCount);$("#"+domKey).find(".ubo-pscIndividualCount .ubo-count").text(pscIndividualCount);$("#"+domKey).find(".ubo-pscEntityCount .ubo-count").text(pscEntityCount);$("#"+domKey).find(".ubo-superSecureCount .ubo-count").text(superSecureCount);$("#"+domKey).find(".ubo-soeStateCount .ubo-count").text(soeStateCount);$("#"+domKey).find(".ubo-soeGovCount .ubo-count").text(soeGovCount);$("#"+domKey).find(".ubo-soePublicCount .ubo-count").text(soePublicCount);$("#"+domKey).find(".ubo-soePrivateCount .ubo-count").text(soePrivateCount);$("#"+domKey).find(".ubo-view-more").on("click",function(){var dialogHt=parentHt*.8;var dialogWd=parentWd*.65;var dialog;dialog=$("#"+domKey+"-dialog-countryCounts").dialog({height:dialogHt,width:dialogWd,modal:true,title:"Connections per Country",resizable:false,close:function(event,ui){$(this).dialog("destroy")}});if($("#"+domKey).find("canvas").width()>1200){$(".ui-widget-overlay").appendTo("#"+domKey);$("#"+domKey+"-dialog-countryCounts").parent().appendTo("#"+domKey)}$("#"+domKey+"-dialog-countryCounts").parent().position({of:window});$("#"+domKey+"-dialog-countryCounts").parent().addClass("ubo-dialog-box");$("#"+domKey+"-dialog-countryCounts").parents(".ubo-dialog-box").find(".ui-dialog-titlebar-close").attr("title","Close");$("#"+domKey+"-dialog-countryCounts").parents(".ubo-dialog-box").find(".ui-dialog-titlebar-close").find("span").remove();$("#"+domKey+"-dialog-countryCounts").parents(".ubo-dialog-box").find(".ui-dialog-titlebar-close").find("i").remove();$("#"+domKey+"-dialog-countryCounts").parents(".ubo-dialog-box").find(".ui-dialog-titlebar-close").append('<i class="fa fa-times" aria-hidden="true"></i>');$("#"+domKey+"-dialog-countryCounts").find(".ubo-countryCountSet").empty();var unknownCount=0;$.each(sortedCtryList,function(key,value){var ctryCode=key.substr(0,key.indexOf(","));var ctryName=key.substr(key.indexOf(",")+1);if(ctryCode=="unknown"){unknownCount=value}else{$("#"+domKey+"-dialog-countryCounts").find(".ubo-countryCountSet").append('<div class="ubo-countWrap"><img src="'+UBO_RESOURCE_URL+"/"+"img/flag/"+ctryCode.toLowerCase()+'.png"'+' width="18px" height="17px"/><span class="ubo-countText">'+ctryName+'</span><span>:</span> <span class="ubo-count">'+value+"</span></div> ")}});if(unknownCount>0){$("#"+domKey+"-dialog-countryCounts").find(".ubo-countryCountSet").append('<div class="ubo-countWrap"><img src="'+UBO_RESOURCE_URL+"/"+'img/flag/unknown.png"'+' width="18px" height="17px"/><span class="ubo-countText">Unknown</span><span>:</span> <span class="ubo-count">'+unknownCount+"</span></div> ")}})}}function renderGraph(containerId,parentId,data,lang){try{var domKey=parentId+"-"+containerId;if(lang==undefined){HELP_LANG="en"}else if(lang=="nl_NL"){HELP_LANG="nl"}else if(lang=="en_GB"){HELP_LANG="en"}else if(lang=="fr_FR"){HELP_LANG="fr"}else if(lang=="de_DE"){HELP_LANG="de"}else if(lang=="it_IT"){HELP_LANG="it"}else HELP_LANG="en";if(!$("#"+domKey).length){injectUboContainerTo(containerId,parentId)}var uboGraph=new UBOGraph(containerId,parentId,data);data=null;uboGraph.validateRequest();$("#"+domKey+" #ubo-loading").fadeIn(400,"swing",function(){try{uboGraph.ogmaObj=uboGraph.initGraph()}catch(err){uboErrorhandler(err,domKey)}})}catch(err){uboErrorhandler(err,domKey);console.log(err)}return uboGraph}function uboErrorhandler(err,domKey){$("#"+domKey+" #ubo-loading").hide();console.log(err);$("#"+domKey+" .ubo-error").html('<p align="center">'+err+"</p>");$("#"+domKey+" #ubo-message").show()}function formatDUNS(s){var m=s.match(/^(\S{2})(\S{3})(\S{4})$/);return!m?s:m[1]+"-"+m[2]+"-"+m[3]}function setReason(val,html){if(val.length>0&&val[0].hasOwnProperty("UnavailableReasonText")&&val[0].UnavailableReasonText.hasOwnProperty("$")){html+="<tr><th>Further Ownership Unavailable</th> <td>"+val[0].UnavailableReasonText.$+"</td></tr>"}return html}function setPSCReason(val,html){if(val.length>0&&val[0].hasOwnProperty("UnavailableReasonDescription")&&val[0].UnavailableReasonDescription.hasOwnProperty("$")){html+="<tr><th>PSC Exemption</th> <td>"+val[0].UnavailableReasonDescription.$+"</td></tr>"}return html}function setNOCClassDescription(val){var noc="";var count=0;if(val!=undefined){for(var i=0;i<val.length;i++){if(val[i].hasOwnProperty("$")){noc+=val[i].$;count++}if(count<val.length)noc+=", "}}return noc}function addressFormation(val,html){var address=[];var completeAddress="";var addressAftertrim="";if(val.hasOwnProperty("StreetAddressLine")){for(var j=0;j<val.StreetAddressLine.length;j++){address.push(val.StreetAddressLine[j].LineText)}}val.hasOwnProperty("PrimaryTownName")?address.push(val.PrimaryTownName):"";val.hasOwnProperty("TerritoryName")?address.push(val.TerritoryName):"";val.hasOwnProperty("PostalCode")?address.push(val.PostalCode):"";if(val.hasOwnProperty("CountryOfficialName")&&val.hasOwnProperty("CountryISOAlpha2Code")&&(val.CountryISOAlpha2Code=="HK"||val.CountryISOAlpha2Code=="MO"))address.push(val.CountryOfficialName+" SAR");else if(val.hasOwnProperty("CountryOfficialName")&&val.hasOwnProperty("CountryISOAlpha2Code")&&val.CountryISOAlpha2Code=="TW")address.push(val.CountryOfficialName+" Region");else val.hasOwnProperty("CountryOfficialName")?address.push(val.CountryOfficialName):val.hasOwnProperty("CountryISOAlpha2Code")?address.push(val.CountryISOAlpha2Code):"";for(var j=0;j<address.length;j++){if(address[j].length>33){addressAftertrim=trimAndAppendFieldsOnHover(address[j]);addressAftertrim='<span class="ubo-tooltip-name">'+addressAftertrim.substring(0,33)+"</br>"+addressAftertrim.substring(33,addressAftertrim.length)+"</span>";completeAddress==""?completeAddress=addressAftertrim:completeAddress=completeAddress+"</br>"+addressAftertrim}else{completeAddress==""?completeAddress=address[j]:completeAddress=completeAddress+"</br>"+address[j]}}if(completeAddress!="")html+="<tr><th>Address</th> <td>"+completeAddress+"</td></tr>";return html}function getaddress(val){var address=[];var completeAddress="";var addressAftertrim="";if(val.hasOwnProperty("StreetAddressLine")){for(var j=0;j<val.StreetAddressLine.length;j++){address.push(val.StreetAddressLine[j].LineText)}}val.hasOwnProperty("PrimaryTownName")?address.push(val.PrimaryTownName):"";val.hasOwnProperty("TerritoryName")?address.push(val.TerritoryName):"";val.hasOwnProperty("PostalCode")?address.push(val.PostalCode):"";if(val.hasOwnProperty("CountryOfficialName")&&val.hasOwnProperty("CountryISOAlpha2Code")&&(val.CountryISOAlpha2Code=="HK"||val.CountryISOAlpha2Code=="MO"))address.push(val.CountryOfficialName+" SAR");else if(val.hasOwnProperty("CountryOfficialName")&&val.hasOwnProperty("CountryISOAlpha2Code")&&val.CountryISOAlpha2Code=="TW")address.push(val.CountryOfficialName+" Region");else val.hasOwnProperty("CountryOfficialName")?address.push(val.CountryOfficialName):val.hasOwnProperty("CountryISOAlpha2Code")?address.push(val.CountryISOAlpha2Code):"";for(var j=0;j<address.length;j++){completeAddress==""?completeAddress=address[j]:completeAddress=completeAddress+" "+address[j]}if(completeAddress!="")return completeAddress}function getCurrentDate(){var currentTime=new Date;var year=currentTime.getFullYear();var month=(1+currentTime.getMonth()).toString();month=month.length>1?month:"0"+month;var day=currentTime.getDate().toString();day=day.length>1?day:"0"+day;return day+month+year}function injectUboContainerTo(containerId,parentId){var wrapperId=parentId+"-"+containerId;var containerDiv='<div id="'+parentId+"-"+containerId+'" class="ubo-graph-container-body">'+" \x3c!-- Legend --\x3e"+'<div id="ubo-legend">'+'<div><span class="fa-stack fa-1x">'+'<i class="fa fa-circle fa-stack-2x" style="color:#FF756E;"></i>'+'<i class="fa fa-university fa-stack-1x" style="color:black;"></i>'+"</span>"+'<span class="ubo-legend-text">Target</span></div>'+'<div><span class="fa-stack fa-1x">'+'<i class="fa fa-circle fa-stack-2x" style="color:#68BDF6;"></i>'+'<i class="fa fa-university fa-stack-1x" style="color:black"></i>'+"</span>"+'<span class="ubo-legend-text">Organisation</span></div>'+'<div><span class="fa-stack fa-1x">'+'<i class="fa fa-circle fa-stack-2x" style="color:grey;"></i>'+'<i class="fa fa-university fa-stack-1x" style="color:black;"></i>'+"</span>"+'<span class="ubo-legend-text">OOB Organisation</span></div>'+'<div><span class="fa-stack fa-1x">'+'<i class="fa fa-circle fa-stack-2x" style="color:#6DCE9E;"></i>'+'<i class="fa fa-user fa-stack-1x" style="color:black;"></i>'+"</span>"+'<span class="ubo-legend-text">Individual</span></div>'+'<div><span class="fa-stack fa-1x">'+'<i class="fa fa-circle fa-stack-2x" style="color:#6DCE9E;"></i>'+'<i class="fa fa-users fa-stack-1x" style="color:black;"></i>'+"</span>"+'<span class="ubo-legend-text">Entity</span></div>'+'<div><span class="fa-stack fa-1x">'+'<i class="fa fa-circle fa-stack-2x" style="color:#ff99ff;"></i>'+'<i class="fa fa-university fa-stack-1x" style="color:black;"></i>'+"</span>"+'<span class="ubo-legend-text">State Owned Organisations</span></div>'+'<div><span class="fa-stack fa-1x">'+'<i class="fa fa-circle fa-stack-2x" style="color:#e600e6;"></i>'+'<i class="fa fa-university fa-stack-1x" style="color:black;"></i>'+"</span>"+'<span class="ubo-legend-text">Government Organisations</span></div>'+'<div><span class="fa-stack fa-1x">'+'<i class="fa fa-circle fa-stack-2x" style="color:#ff66ff;"></i>'+'<i class="fa fa-university fa-stack-1x" style="color:black;"></i>'+"</span>"+'<span class="ubo-legend-text">Publicly Trading Organisations</span></div>'+'<div><span class="fa-stack fa-1x">'+'<i class="fa fa-circle fa-stack-2x" style="color:#ffccff;"></i>'+'<i class="fa fa-university fa-stack-1x" style="color:black;"></i>'+"</span>"+'<span class="ubo-legend-text">Privately Held Organisations</span></div>'+'<div><span class="fa-stack fa-1x">'+'<i class="fa fa-circle fa-stack-2x" style="color:#bab86c;"></i>'+'<i class="fa fa-gavel fa-stack-1x fa-inverse" style="color:black;"></i>'+"</span>"+'<span class="ubo-legend-text">Legally Withheld</span></div>'+'<div><span class="fa-stack fa-1x">'+'<i class="fa fa-circle fa-stack-2x" style="color:#fff;"></i>'+'<i class="fa fa-long-arrow-right fa-stack-1x"></i>'+"</span>"+'<span class="ubo-legend-text">SHARES %/MAJORITY HELD BY</span></div>'+'<div><span class="fa-stack fa-1x">'+'<i class="fa fa-circle fa-stack-2x" style="color:#fff;"></i>'+'<i class="fa fa-long-arrow-right fa-stack-1x" style="color:#1DACD6;"></i>'+"</span>"+'<span class="ubo-legend-text">Persons of Significant Control </span></div>'+'<div><span class="fa-stack fa-1x">'+'<i class="fa fa-circle fa-stack-2x" style="color:#FF756E;"></i>'+'<i class="fa fa-percent fa-stack-1x fa-inverse"></i>'+"</span>"+'<span class="ubo-legend-text">Beneficial Ownership % of Target</span></div>'+"</div>"+" \x3c!-- leftViewController --\x3e"+'<div id="ubo-leftViewController">'+'<span class="ubo-advancedCtrlTitle" style="">Advanced Options</span>'+'<span class="headerspan"><button type="button" class="ubo-btn ubo-btn-default" id="toggleLeftMenu" title="Hide advanced graph options" style="position:absolute; top: 42%; font-size: 16px; right:0px;">'+'<i class="fa fa-angle-double-left"></i>'+"</button></span>"+'<div class="ubo-menu-body">'+'<h4 id="ubo-filter-expand">Filter<i class="fa fa-angle-down"></i></h4>'+'<div class="ubo-menu-section-content" style="display:none;">'+'<div class="ubo-beneficial-reading">Beneficial Ownership % : <input type="text" id="amount" readonly style="border:0; maxlength="3" size="3" value="0">\x3c!--<p id="ubo-break"></p>--\x3e</div>'+'<div class="ubo-slider-wrap">'+'<div class="ubo-slideWrap"><div id="ubo-slider"><div class="ubo-slider-limit"></div></div>'+'<div class="ubo-marker ubo-marker-0"><span>0<sup>%</sup></span></div>'+'<div class="ubo-marker ubo-marker-10"><span>10<sup>%</sup></span></div>'+'<div class="ubo-marker ubo-marker-25"><span>25<sup>%</sup></span></div>'+'<div class="ubo-marker ubo-marker-50"><span>50<sup>%</sup></span></div>'+'<div class="ubo-marker ubo-marker-75"><span>75<sup>%</sup></span></div>'+'<div class="ubo-marker ubo-marker-100"><span>100<sup>%</sup></span></div>'+"</div>"+'<p id="ubo-filterBr" style="display:none"></p>'+'<span id="checkUndisclosed" ><input id="box-exclude-ud" type="checkbox" title="Filter Undisclosed" checked=true> Include Undisclosed </span>'+"</div></div>"+'<h4>Display<i class="fa fa-angle-down"></i></h4>'+'<div class="ubo-menu-section-content" style="display:none;">'+'<div class="ubo-checkwrap"><input id="box-run-layout" type="checkbox" title="Re runs the layout" checked> <label for="box-run-layout">Update Layout</label></div>'+'<div class="ubo-checkwrap"><input id="info-msg" type="checkbox" title="Informative Messages"> <label for="info-msg">Informative Messages</label></div>'+"</div>"+'<h4>Actions<i class="fa fa-angle-down"></i></h4>'+'<div class="ubo-menu-section-content" style="display:none;">'+'<button id="search" title="Find in Graph" name="search" class="ubo-btnAction ubo-acitonmenu" style="background-color:white">Find in Graph<br></button>'+'<button id="merge"   title="Merge Nodes" name="merge" class="ubo-btnAction ubo-acitonmenu" style="background-color:white">Merge Nodes<br></button>'+'<button id="addNode"   title="Add Node/Relationship" name="Add Node/Relationship" class="ubo-btnAction ubo-acitonmenu" style="background-color:white">Create Nodes and Relationships<br></button>'+'<button id="nodeLabel" class="ubo-btnAction ubo-acitonmenu" title="Configure existing node labels " style="background-color:white">Configure Node Labels</button>'+'<button id="btnReset" type="btnReset" class="ubo-btnAction ubo-acitonmenu" title="Reset All">Reset</button>'+"</div>"+'<h4 id="ubo_CountSection">Counts<i class="fa fa-angle-down"></i></h4>'+'<div class="ubo-menu-section-content" id="ubo-menu-countSection-content" style="display:none;">'+'<h3 class="ubo-subHead innerAccordion">Connections breakdown<i class="fa fa-plus-circle" aria-hidden="true"></i></h3>'+'<div class="ubo-menu-section-innerAccordioncontent" style="display:none;">'+'<div class="ubo-countWrap ubo-orgCount"><a title="Click to highlight nodes in graph" class="ubo_CountHighlight" data-nameCount="benCount"><span class="ubo-orgCntImg"> <i class="fa fa-university" aria-hidden="true"> </i></span><span class="ubo-countText">Organisation</span><span>:</span><span class="ubo-count"></span> </a></div>'+'<div class="ubo-countWrap ubo-entityCount"><a title="Click to highlight nodes in graph" class="ubo_CountHighlight" data-nameCount="benCount"><span class="ubo-entityCntImg"> <i class="fa fa-users" aria-hidden="true"></i></span><span class="ubo-countText">Entity </span><span>:</span> <span class="ubo-count"></span></a></div>'+'<div class="ubo-countWrap ubo-individualCount"> <a title="Click to highlight nodes in graph" class="ubo_CountHighlight" data-nameCount="benCount"><span class="ubo-indvdlCntImg"> <i class="fa fa-user" aria-hidden="true"></i></span><span class="ubo-countText">Individual </span><span>:</span> <span class="ubo-count"></span> </a></div>'+'<div class="ubo-countWrap ubo-oobCount"><a title="Click to highlight nodes in graph" class="ubo_CountHighlight" data-nameCount="benCount"> <span class="ubo-oobCntImg"> <i class="fa fa-university" aria-hidden="true"> </i> </span><span class="ubo-countText">OOB </span><span>:</span> <span class="ubo-count"></span></a> </div>'+"</div>"+'<h3 class="ubo-subHead innerAccordion">Connections for Control Type<i class="fa fa-plus-circle" aria-hidden="true"></i></h3>'+'<div class="ubo-menu-section-innerAccordioncontent" style="display:none;">'+'<div class="ubo-countWrap ubo-soeStateCount"><span class="ubo-soeImg1"> <i class="fa fa-university" aria-hidden="true"> </i></span> <span class="ubo-countText">State Owned</span><span>:</span> <span class="ubo-count"></span> </div>'+'<div class="ubo-countWrap ubo-soeGovCount"><span class="ubo-soeImg2"> <i class="fa fa-university" aria-hidden="true">  </i></span> <span class="ubo-countText">Government</span><span>:</span> <span class="ubo-count"></span> </div>'+'<div class="ubo-countWrap ubo-soePublicCount"><span class="ubo-soeImg3"> <i class="fa fa-university" aria-hidden="true">  </i></span> <span class="ubo-countText">Publicly Trading</span><span>:</span> <span class="ubo-count"></span> </div>'+'<div class="ubo-countWrap ubo-soePrivateCount"><span class="ubo-soeImg4"> <i class="fa fa-university" aria-hidden="true"> </i> </span> <span class="ubo-countText">Privately Held</span><span>:</span> <span class="ubo-count"></span> </div>'+"</div>"+'<h3 class="ubo-subHead innerAccordion">Connections per country<i class="fa fa-plus-circle" aria-hidden="true"></i></h3>'+'<div class="ubo-menu-section-innerAccordioncontent" style="display:none;">'+'<div class="ubo-countryCountWrap">'+"</div>"+'<div class="ubo-countWrap ubo-view-more" style="display:none;"><span>View all...</span></div>'+"</div>"+'<h3 class="ubo-subHead innerAccordion">Persons of Significant Control<i class="fa fa-plus-circle" aria-hidden="true"></i></h3>'+'<div class="ubo-menu-section-innerAccordioncontent" style="display:none;">'+'<div class="ubo-countWrap ubo-pscOrgCount"><a title="Click to highlight nodes in graph" class="ubo_CountHighlight" data-nameCount="pscCount"><span class="ubo-orgCntImg"> <i class="fa fa-university" aria-hidden="true"> </i></span><span class="ubo-countText">Organisation</span><span>:</span> <span class="ubo-count"></span></a> </div>'+'<div class="ubo-countWrap ubo-pscEntityCount"><a title="Click to highlight nodes in graph" class="ubo_CountHighlight" data-nameCount="pscCount"><span class="ubo-entityCntImg"> <i class="fa fa-users" aria-hidden="true">  </i></span> <span class="ubo-countText">Entity </span><span>:</span> <span class="ubo-count"></span></a> </div>'+'<div class="ubo-countWrap ubo-pscIndividualCount"><a title="Click to highlight nodes in graph" class="ubo_CountHighlight" data-nameCount="pscCount"><span class="ubo-indvdlCntImg"> <i class="fa fa-user" aria-hidden="true">  </i></span> <span class="ubo-countText">Individual </span><span>:</span> <span class="ubo-count"></span></a> </div>'+'<div class="ubo-countWrap ubo-superSecureCount"><a title="Click to highlight nodes in graph" class="ubo_CountHighlight" data-nameCount="pscCount"><span class="ubo-ssCntImg"> <i class="fa fa-gavel" aria-hidden="true"> </i> </span> <span class="ubo-countText">Legally Withheld</span><span>:</span> <span class="ubo-count"></span> </a></div>'+"</div>"+"</div>"+'<h4>Relationships<i class="fa fa-angle-down"></i></h4>'+'<div class="ubo-menu-section-content" style="display:none;">'+'<div class="ubo-checkwrap"><input id="show-psc" type="checkbox" title="Persons of Significant Control" checked> <label for="show-psc">Persons of Significant Control</label></div>'+"</div>"+"</div>"+"</div>"+"\x3c!--Dialog box Node--\x3e"+'<div id="'+parentId+"-"+containerId+'-dialog-form"  style="display:none;" title="Add node">'+'<div class="ubo-input-sub"><label for="'+parentId+"-"+containerId+'-relationTypeSelect">Relationship Type</label>'+'<select id="'+parentId+"-"+containerId+'-relationTypeSelect" class="text ui-widget-content ui-corner-all" data-parentId="'+parentId+'" data-containerId="'+containerId+'" onchange="showPercentage(event,this.options[this.selectedIndex].value)">'+'<option value="Ownership" selected>Ownership</option>'+'<option value="PSC">Persons of Significant Control</option>'+"</select></div>"+'<div class="ubo-input-sub"><label for="'+parentId+"-"+containerId+'-nodeTypeSelect">Node Type</label>'+'<select id="'+parentId+"-"+containerId+'-nodeTypeSelect" class="text ui-widget-content ui-corner-all"><option value="0">Select</option>'+'<option value="1">Organisation</option>'+'<option value="2">Individual</option>'+'<option value="3">Entity</option>'+"</select></div>"+'<div class="ubo-input-sub"><label for="'+parentId+"-"+containerId+'-primaryText">Primary Text</label>'+'<input type="text"  placeholder="Name of new node" maxlength="60" id="'+parentId+"-"+containerId+'-primaryText" class="text ui-widget-content ui-corner-all"></div>'+'<div class="ubo-input-sub"><label for="'+parentId+"-"+containerId+'-secondaryText">Secondary Text</label>'+'<input type="text"  placeholder="Additional information" maxlength="60" id="'+parentId+"-"+containerId+'-secondaryText" class="text ui-widget-content ui-corner-all"></div>'+'<div class="ubo-input-sub onlyForPSC" id="'+parentId+"-"+containerId+'-percentageValNodeWrapper"><label for="'+parentId+"-"+containerId+'-percentageValNode">Percentage</label>'+'<input type="text" id="'+parentId+"-"+containerId+'-percentageValNode" placeholder="Undisclosed" class="text ui-widget-content ui-corner-all" onkeypress="return validatePercentage(this,event)" /></div>'+'<div class="ubo-input-sub onlyForPSC" id="'+parentId+"-"+containerId+'-nocClassSelectWrapper" style="display:none;"><label for="'+parentId+"-"+containerId+'-nocClassSelect">Nature of Control</label>'+'<select id="'+parentId+"-"+containerId+'-nocClassSelect" class="text ui-widget-content ui-corner-all" onchange="">'+'<option value="0" selected>Select</option>'+'<option value="1">Share or rights 25 to 50 %</option>'+'<option value="2">Share or rights 50 to 75%</option>'+'<option value="3">Share or rights 75 to 100%</option>'+'<option value="4">Right to Appoint / Remove</option>'+'<option value="5">Influence or Control</option>'+"</select></div>"+"</div>"+"\x3c!--Dialog box Edge--\x3e"+'<div id="'+parentId+"-"+containerId+'-dialog-form-edge"  style="display:none;" title="Add Relationship">'+'<div class="ubo-input-sub"><label for="'+parentId+"-"+containerId+'-percentageVal">Percentage</label>'+'<input type="textbox" id="'+parentId+"-"+containerId+'-percentageVal" placeholder="Undisclosed" class="text ui-widget-content ui-corner-all" onkeypress="return validatePercentage(this,event)" /></div>'+"</div>"+"\x3c!--Configure label dialog box --\x3e"+'<div id="'+parentId+"-"+containerId+'-nodeLabeldialog" style="display:none;">'+"<form>"+'<span class="fa-stack fa-1x">'+'<i class="fa fa-circle fa-stack-2x" style="color:#6DCE9E;"></i>'+'<i class="fa fa-user fa-stack-1x" style="color:black;"></i>'+'<span class="ubo-configureLabelsText"><b>Individuals</b></span>'+"</span><br>"+'<div id="ubo-label-individual">'+'<div class="ubo-input-sub"><input id="'+parentId+"-"+containerId+'-uboIndAdd" type="checkbox" name="indAdd" value="add"><label>Address</label></div>'+'<div class="ubo-input-sub"><input type="checkbox" name="indDOB"  id="'+parentId+"-"+containerId+'-uboIndDOB" value="dob"><label>Date of Birth</label></div>'+'<div class="ubo-input-sub"><input type="checkbox" name="indNationality"  id="'+parentId+"-"+containerId+'-uboindNationality" value="Nationality"><label>Nationality (PSC)</label></div>'+'<div class="ubo-input-sub"><input type="checkbox" name="indDoNOC"  id="'+parentId+"-"+containerId+'-uboindDoNOC" value="indDoNOC"><label>Date of NOC (PSC)</label></div>'+'<div class="ubo-input-sub"><input type="checkbox" name="indNOC"  id="'+parentId+"-"+containerId+'-uboindNOC" value="indNOC"><label>Nature of Control (NOC)</label></div>'+'<div class="ubo-input-sub"><input type="checkbox" name="indCtryRes"  id="'+parentId+"-"+containerId+'-uboindCtryRes" value="indCtryRes"><label>Country of Residence (PSC)</label></div>'+"</div>"+'<span class="fa-stack fa-1x">'+'<i class="fa fa-circle fa-stack-2x" style="color:#6DCE9E;"></i>'+'<i class="fa fa-users fa-stack-1x" style="color:black;"></i>'+'<span class="ubo-configureLabelsText"><b>Entities</b></span>'+"</span><br>"+'<div id="ubo-label-Entities">'+'<div class="ubo-input-sub"><input type="checkbox" name="entAdd"  id="'+parentId+"-"+containerId+'-uboEntAdd" value="add"><label>Address</label></div>'+'<div class="ubo-input-sub"><input type="checkbox" name="entcountry"  id="'+parentId+"-"+containerId+'-uboEntCountry" value="country"><label>Country</label></div>'+'<div class="ubo-input-sub"><input type="checkbox" name="entNOC"  id="'+parentId+"-"+containerId+'-uboentNOC" value="entNOC"><label>Nature of Control (NOC)</label></div>'+'<div class="ubo-input-sub"><input type="checkbox" name="entDoNOC"  id="'+parentId+"-"+containerId+'-uboentDoNOC" value="entDoNOC"><label>Date of NOC (PSC)</label></div>'+'<div class="ubo-input-sub"><input type="checkbox" name="entLegAuth"  id="'+parentId+"-"+containerId+'-uboentLegAuth" value="entLegAuth"><label>Legal Authority (PSC)</label></div>'+'<div class="ubo-input-sub"><input type="checkbox" name="entLegForm"  id="'+parentId+"-"+containerId+'-uboentLegForm" value="entLegForm"><label>Legal Form (PSC)</label></div>'+"</div>"+'<span class="fa-stack fa-1x">'+'<i class="fa fa-circle fa-stack-2x" style="color:#68BDF6;"></i>'+'<i class="fa fa-university fa-stack-1x" style="color:black;"></i>'+'<span class="ubo-configureLabelsText"><b>Organisations</b></span>'+"</span><br>"+'<div id="ubo-label-Org">'+'<div class="ubo-input-sub"><input type="checkbox" name="orgAddress"  id="'+parentId+"-"+containerId+'-uboOrgAddress" value="orgAddress"><label>Address</label></div>'+'<div class="ubo-input-sub"><input type="checkbox" name="uboOrgduns"  id="'+parentId+"-"+containerId+'-uboDuns" value="duns"><label>D-U-N-S®</label></div>'+'<div class="ubo-input-sub"><input type="checkbox" name="orgcountry"  id="'+parentId+"-"+containerId+'-uboOrgcountry" value="country"><label>Country</label></div>'+'<div class="ubo-input-sub"><input type="checkbox" name="controlType" id="'+parentId+"-"+containerId+'-uboControlType" value="controlType"><label>Control Type</label></div>'+'<div class="ubo-input-sub"><input type="checkbox" name="legalForm"  id="'+parentId+"-"+containerId+'-uboLegalForm" value="legalForm"><label>Legal Form</label></div>'+'<div class="ubo-input-sub"><input type="checkbox" name="orgNOC"  id="'+parentId+"-"+containerId+'-uboorgNOC" value="orgNOC"><label>Nature of Control (NOC)</label></div>'+'<div class="ubo-input-sub"><input type="checkbox" name="orgDoNOC"  id="'+parentId+"-"+containerId+'-uboorgDoNOC" value="orgDoNOC"><label>Date of NOC (PSC)</label></div>'+"</div>"+"</form>"+"</div>"+"\x3c!--Search dialog box --\x3e"+'<div id="'+parentId+"-"+containerId+'-searchDialog" class="ubo-search-dialog" style="display:none;">'+'<div id="ubo-search-header" class="ubo-search-header"><span>Find in Graph</span><span class="ubo-search-close"><i class="fa fa-times" aria-hidden="true"></i></span></div>'+'<div class="ubo-search-content">'+"<form>"+'<div class="ubo-search-box">'+'<div id="ubo-search-criteria" class="ubo-search-criteria"><span class="ubo-selected-criteria">Name</span><i class="fa fa-angle-down"></i></div>'+'<div id="ubo-criteria-options" class="ubo-criteria-options" style="display:none;"><span id="byName" class="ubo-selectedCr">Name</span><span id="byDuns">D-U-N-S®</span><span id="byCountry">Country</span></div>'+'<input type="text" autofocus class="ubo-seach-input"/>'+'<a href="javascript:void(0)" class="ubo-search-btn" title="Search"><i class="fa fa-search" aria-hidden="true"></i></a>'+"</div>"+"</form>"+'<a href="javascript:void(0)" class="ubo-clearSearch"> Clear Search </a>'+'<span class="ubo-errMsg"></span>'+"</div>"+"</div>"+"\x3c!--Dialog box Country counts--\x3e"+'<div id="'+parentId+"-"+containerId+'-dialog-countryCounts"  style="display:none;">'+'<div class="ubo-countryCountSet"></div>'+"</div>"+"\x3c!--Dialog box Help--\x3e"+'<div id="'+parentId+"-"+containerId+'-dialog-help"  style="display:none;">'+'<div class="ubo-helpTitleSection">'+"<ul>"+'<li id="ubo-graphCtrlshelp">'+"<span><label></label></span>"+"<ul>"+'<li id="ubo-fullscreenHelp"><span><label></label><i class="fa fa-expand"></i></span></li>'+'<li id="ubo-exportPngHelp"><span><label></label><i class="fa fa-image"></i></span></li>'+'<li id="ubo-pathLargBenHelp"><span><label></label><i class="fa fa-road" aria-hidden="true"></i></span></li>'+'<li id="ubo-togglePulseHelp"><span><label></label><i class="fa fa-bullseye"></i></span></li>'+'<li id="ubo-toggleLegendHelp"><span><label></label><i class="fa fa-eye"></i></span></li>'+'<li id="ubo-toggleLabelHelp"><span><label></label><i class="fa fa-address-card-o"></i></span></li>'+'<li id="ubo-toggleArrowHelp"><span><label></label><i class="fa fa-exchange"></i></span></li>'+'<li id="ubo-changeLayoutHelp"><span><label></label><i class="fa fa-snowflake-o"></i></span></li>'+'<li id="ubo-rotateRightHelp"><span><label></label><i class="fa fa-rotate-right"></i></span></li>'+'<li id="ubo-rotateLeftHelp"><span><label></label><i class="fa fa-rotate-left"></i></span></li>'+'<li id="ubo-zoomOutHelp"><span><label></label><i class="fa fa-minus"></i></span></li>'+'<li id="ubo-zoomInHelp"><span><label></label><i class="fa fa-plus"></i></span></li>'+'<li id="ubo-locateTargetHelp"><span><label></label><i class="fa fa-location-arrow"></i></span></li>'+'<li id="ubo-locateCenterHelp"><span><label></label><i class="fa fa-home"></i></span></li>'+"</ul>"+"</li>"+'<li id="ubo-graphLayoutHelp">'+"<span><label></label></span>"+"<ul>"+'<li id="ubo-forcedLinkHelp"><span><label></label></span></li>'+'<li id="ubo-radialhelp"><span><label></label></span></li>'+'<li id="ubo-hierachicalhelp"><span><label></label></span></li>'+'<li id="ubo-concentricHelp"><span><label></label></span></li>'+'<li id="ubo-gridHelp"><span><label></label></span></li>'+"</ul>"+"</li>"+'<li id="ubo-otherFunctionsHelp">'+"<span><label></label></span>"+"<ul>"+'<li id="ubo-moveArrowhelp"><span><label></label></span></li>'+'<li id="ubo-moveTreeHelp"><span><label></label></span></li>'+"</ul>"+"</li>"+'<li id="ubo-advCtrlPanelHelp">'+"<span><label></label></span>"+"<ul>"+'<li id="ubo-filterHelp"><span><label></label></span></li>'+'<li id="ubo-updateLayoutHelp"><span><label></label></span></li>'+'<li id="ubo-hideMsgingHelp"><span><label></label></span></li>'+'<li id="ubo-searchbarHelp"><span><label></label></span></li>'+'<li id="ubo-mergeNodeHelp"><span><label></label></span></li>'+'<li id="ubo-addNodeRelHelp"><span><label></label></span></li>'+'<li id="ubo-configNodeHelp"><span><label></label></span></li>'+'<li id="ubo-resetHelp"><span><label></label></span></li>'+'<li id="ubo-countsHelp"><span><label></label></span></li>'+'<li id="ubo-relationHelp"><span><label>Relationships</label></span></li>'+"</ul>"+"</li>"+"</ul>"+"</div>"+'<div class="ubo-helpDetailSection"><div class="ubo-breadcrumb"></div><div class="ubo-detailsWrap">'+'<div class="ubo-helpDetailsDiv"><p></p></div>'+'<div class="ubo-helpDetailsDiv" id="ubo-fullscreenHelp_Div"><p></p></div>'+'<div class="ubo-helpDetailsDiv" id="ubo-exportPngHelp_Div"><p></p></div>'+'<div class="ubo-helpDetailsDiv" id="ubo-pathLargBenHelp_Div"><p></p></div>'+'<div class="ubo-helpDetailsDiv" id="ubo-togglePulseHelp_Div"><p></p></div>'+'<div class="ubo-helpDetailsDiv" id="ubo-toggleLegendHelp_Div"><p></p></div>'+'<div class="ubo-helpDetailsDiv" id="ubo-toggleLabelHelp_Div"><p></p></div>'+'<div class="ubo-helpDetailsDiv" id="ubo-toggleArrowHelp_Div"><p></p></div>'+'<div class="ubo-helpDetailsDiv" id="ubo-changeLayoutHelp_Div"><p></p></div>'+'<div class="ubo-helpDetailsDiv" id="ubo-rotateRightHelp_Div"><p></p></div>'+'<div class="ubo-helpDetailsDiv" id="ubo-rotateLeftHelp_Div"><p></p></div>'+'<div class="ubo-helpDetailsDiv" id="ubo-zoomOutHelp_Div"><p></p></div>'+'<div class="ubo-helpDetailsDiv" id="ubo-zoomInHelp_Div"><p></p></div>'+'<div class="ubo-helpDetailsDiv" id="ubo-locateTargetHelp_Div"><p></p></div>'+'<div class="ubo-helpDetailsDiv" id="ubo-locateCenterHelp_Div"><p></p></div>'+'<div class="ubo-helpDetailsDiv" id="ubo-forcedLinkHelp_Div"><p></p></div>'+'<div class="ubo-helpDetailsDiv" id="ubo-radialhelp_Div"><p></p></div>'+'<div class="ubo-helpDetailsDiv" id="ubo-hierachicalhelp_Div"><p></p></div>'+'<div class="ubo-helpDetailsDiv" id="ubo-concentricHelp_Div"><p></p></div>'+'<div class="ubo-helpDetailsDiv" id="ubo-gridHelp_Div"><p></p></div>'+'<div class="ubo-helpDetailsDiv" id="ubo-moveArrowhelp_Div"><p></p></div>'+'<div class="ubo-helpDetailsDiv" id="ubo-moveTreeHelp_Div"><p></p></div>'+"<div class='ubo-helpDetailsDiv' id='ubo-advCtrlPanelHelp_Div'><p></p></div>"+'<div class="ubo-helpDetailsDiv" id="ubo-filterHelp_Div"><p></p></div>'+'<div class="ubo-helpDetailsDiv" id="ubo-updateLayoutHelp_Div"><p></p></div>'+'<div class="ubo-helpDetailsDiv" id="ubo-mergeNodeHelp_Div"><p></p></div>'+'<div class="ubo-helpDetailsDiv" id="ubo-addNodeRelHelp_Div"><p></p></div>'+"<div class='ubo-helpDetailsDiv' id='ubo-configNodeHelp_Div'><p></p></div>"+"<div class='ubo-helpDetailsDiv' id='ubo-resetHelp_Div'><p></p></div>"+"<div class='ubo-helpDetailsDiv' id='ubo-countsHelp_Div'><p></p></div>"+"<div class='ubo-helpDetailsDiv' id='ubo-relationHelp_Div'><p></p></div>"+"<div class='ubo-helpDetailsDiv' id='ubo-hideMsgingHelp_Div'><p></p></div>"+'<div class="ubo-helpDetailsDiv" id="ubo-searchbarHelp_Div"><p></p></div>'+'<div class="ubo-helpDetailsDiv" id="ubo-titleHelp_Div"><p></p></div>'+"</div></div>"+"</div>"+"\x3c!-- Controls --\x3e"+'<div id="ubo-viewController" class="ubo-btn-group-vertical">'+'<button type="button" class="ubo-btn ubo-btn-default" id="showControls" title="Show/Hide controls">'+'<i id="showControl" class="fa fa-angle-double-up"></i>'+"</button>"+'<div class="ubo-ctrl-toggle-div">'+'<div id="ubo-viewController-left" class="ubo-btn-group-vertical">'+'<button type="button" class="ubo-btn ubo-btn-default" id="toggleLeftMenu" title="Show advanced graph options">'+'<i class="fa fa-angle-double-right"></i>'+"</button>"+"</div>"+'<button type="button" class="ubo-btn ubo-btn-default ubo-control-toggle" id="zoomReset" title="Locate to center">'+'<i class="fa fa-home"></i>'+"</button>"+'<button type="button" class="ubo-btn ubo-btn-default ubo-control-toggle" id="locateRandomNode" title="Locate target node">'+'<i class="fa fa-location-arrow"></i>'+"</button>"+'<button type="button" class="ubo-btn ubo-btn-default ubo-control-toggle" id="zoomIn" title="Zoom In">'+'<i class="fa fa-plus"></i>'+"</button>"+'<button type="button" class="ubo-btn ubo-btn-default ubo-control-toggle" id="zoomOut" title="Zoom Out">'+'<i class="fa fa-minus"></i>'+"</button>"+'<button type="button" class="ubo-btn ubo-btn-default ubo-control-toggle" id="rotateLeft" title="Rotate Left">'+'<i class="fa fa-rotate-left"></i>'+"</button>"+'<button type="button" class="ubo-btn ubo-btn-default ubo-control-toggle" id="rotateRight" title="Rotate Right">'+'<i class="fa fa-rotate-right"></i>'+"</button>"+'<button type="button" class="ubo-btn ubo-btn-default ubo-control-toggle" id="changeLayout" title="Change Layout">'+'<i class="fa fa-snowflake-o"></i>'+"</button>"+'<button type="button" class="ubo-btn ubo-btn-default ubo-control-toggle" id="changeEdgeStyle" title="Toggle arrow shape">'+'<i class="fa fa-exchange"></i>'+"</button>"+'<button type="button" class="ubo-btn ubo-btn-default ubo-control-toggle" id="toggleNodeText" title="Toggle Labels">'+'<i class="fa fa-address-card-o"></i>'+"</button>"+"\x3c!--"+'<button type="button" class="ubo-btn ubo-btn-default ubo-control-toggle" id="selectNodes" title="Select Grpah">'+'  <i class="fa fa-object-group"></i>'+"</button> --\x3e"+'<button type="button" class="ubo-btn ubo-btn-default ubo-control-toggle" id="toggleLegend" title="Toggle Legend">'+'<i class="fa fa-eye"></i>'+"</button>"+'<button type="button" class="ubo-btn ubo-btn-default ubo-control-toggle" id="togglePulse" title="Toggle Pulse">'+'<i class="fa fa-bullseye"></i>'+"</button>"+'<button type="button" class="ubo-btn ubo-btn-default ubo-control-toggle" id="path-large-ben" title="Path to Largest Beneficiary">'+'<i class="fa fa-road" aria-hidden="true"></i>'+"</button>"+'<button type="button" class="ubo-btn ubo-btn-default ubo-control-toggle" id="exportImage" title="Export PNG">'+'\x3c!-- updated on 16 mar from "fa-picture-o" to "fa-image" --\x3e'+'<i class="fa fa-image"></i>'+"</button>"+"</div>"+'<button type="button" class="ubo-btn ubo-btn-default ubo-control-toggle" id="toggleLeftMenu" title="Show advanced graph options">'+'<i class="fa fa-cog"></i>'+"</button>"+'<button type="button" class="ubo-btn ubo-btn-default" id="ubo-help" title="Help">'+'<i id="graph-help" class="fa fa-question-circle"></i>'+"</button>"+'<button type="button" class="ubo-btn ubo-btn-default" id="fullScreen" title="Full screen">'+'<i id="graph-fullScreen" class="fa fa-expand"></i>'+"</button>"+"</div>"+"\x3c!-- Loading --\x3e"+'<div id="ubo-loading">'+'<div id="ubo-loading-mask"></div>'+'<img id="ubo-loading-image" src="'+UBO_RESOURCE_URL+'/img/loading.gif" class="loading">'+"</div>"+"\x3c!-- Message Area --\x3e"+'<div id="ubo-message">'+'<div class="ubo-error"><p align="center">Error Message Holder</p></div>'+" </div>"+'<div id="ubo-toast-message">'+'<div class="ubo-error"><p align="center">Error Message Holder</p></div>'+" </div>";$("#"+parentId+" #"+containerId).append(containerDiv)}function validatePercentage(el,evt){if(evt.which==8){return true}else{var charCode=evt.which?evt.which:event.keyCode;var number=el.value.split(".");if(charCode!=46&&charCode>31&&(charCode<48||charCode>57)){return false}if((number.length>1||number[0].length==0)&&charCode==46){return false}var dotPos=el.value.indexOf(".");if(dotPos>-1&&number[1].length>1){return false}if(number>10&&number[0].length==2&&charCode!=46){return false}if(number>=100){return false}if(number[0].length>0&&number.length!=2&&charCode!=46&&number=="0"){return false}return true}}function getSelectionStart(o){if(o.createTextRange){var r=document.selection.createRange().duplicate();r.moveEnd("character",o.value.length);if(r.text=="")return o.value.length;return o.value.lastIndexOf(r.text)}else return o.selectionStart}function trimAndAppendFieldsOnHover(fullName){var nameAftertrim;if(fullName.length>65){nameAftertrim=fullName.substring(0,62).concat("...")}else{nameAftertrim=fullName.substring(0,fullName.length)}return nameAftertrim}function trimAndAppendFieldsOnHeader(fullName){var nameAftertrim=fullName.substring(0,39);return nameAftertrim.concat("...")}function splitAndAppendString(fullName,content,percentage,noc){var per;var nocval="";var valueLength=0;if(noc!="nil"&&noc!=undefined){for(var i=0;i<noc.length;i++){if(noc[i].hasOwnProperty("$")){nocval+=noc[i].$;valueLength++}else{nocval+=noc[i]}if(noc.length>1){if(valueLength<noc.length){nocval+="\n"}}}}if(percentage==undefined)per="undisclosed";else if(percentage!="nil")per=percentage+"%";if(noc!=undefined&&noc!="nil")per=nocval;if(content==0){content=fullName+": "+per}else{content+=";"+"\n"+fullName+": "+per;var newCo=content.replace(": undefined","");var newCo1=newCo.replace("undefined;","");return newCo}var newCo=content.replace(": undefined","");var newCo1=newCo.replace("undefined;","");return newCo1}function sortObject(obj){var arr=[];var prop;for(prop in obj){if(obj.hasOwnProperty(prop)){arr.push({key:prop,value:obj[prop]})}}arr.sort(function(a,b){return b.value-a.value});var obj={};for(var i=0;i<arr.length;++i)obj[arr[i].key]=arr[i].value;return obj}function split(val){return val.split(/; \s*/)}function extractLast(term){return split(term).pop()}function clearNodeHeighlight(ogma){ogma.getEdges("all").setAttributes({opacity:1});ogma.getNodes("visible").setAttributes({opacity:1,halo:{color:"white",size:0,strokeColor:"white",strokeWidth:0},outerStroke:{color:"white",width:0}})}function showPercentage(event,val){$(".onlyForPSC").hide();var parent=event.target.dataset.parentid,container=event.target.dataset.containerid;var domKey=parent+"-"+container;if(val=="Ownership"){$("#"+domKey+"-percentageValNodeWrapper").show()}else{$("#"+domKey+"-percentageValNodeWrapper").hide();$("#"+domKey+"-nocClassSelectWrapper").show()}}